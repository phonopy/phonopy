<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Phonopy API for Python &#8212; Phonopy v.2.3.0</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Formulations" href="formulation.html" />
    <link rel="prev" title="External tools" href="external-tools.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          Phonopy</a>
        <span class="navbar-text navbar-version pull-left"><b>2.3</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="symmetry.html">Crystal symmetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="procedure.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Work flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="input-files.html">Input files</a></li>
<li class="toctree-l1"><a class="reference internal" href="output-files.html">Output files</a></li>
<li class="toctree-l1"><a class="reference internal" href="setting-tags.html">Setting tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="command-options.html">Command options</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamic-structure-factor.html">Dynamic structure factor</a></li>
<li class="toctree-l1"><a class="reference internal" href="gruneisen.html">Mode Grüneisen parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="qha.html">Quasi harmonic approximation</a></li>
<li class="toctree-l1"><a class="reference internal" href="interfaces.html">Interfaces to calculators</a></li>
<li class="toctree-l1"><a class="reference internal" href="auxiliary-tools.html">Auxiliary tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="external-tools.html">External tools</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Phonopy API for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="formulation.html">Formulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">How to cite phonopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="documentation.html">Documentation</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Phonopy API for Python</a><ul>
<li><a class="reference internal" href="#import-modules">Import modules</a></li>
<li><a class="reference internal" href="#work-flow">Work flow</a><ul>
<li><a class="reference internal" href="#pre-process">Pre-process</a></li>
<li><a class="reference internal" href="#post-process">Post process</a></li>
</ul>
</li>
<li><a class="reference internal" href="#phonon-calculation">Phonon calculation</a><ul>
<li><a class="reference internal" href="#save-parameters-phonopy-save">Save parameters (<code class="docutils literal notranslate"><span class="pre">phonopy.save</span></code>)</a></li>
<li><a class="reference internal" href="#shortcut-to-load-input-files-phonopy-load">Shortcut to load input files (<code class="docutils literal notranslate"><span class="pre">phonopy.load</span></code>)</a></li>
<li><a class="reference internal" href="#band-structure">Band structure</a></li>
<li><a class="reference internal" href="#mesh-sampling">Mesh sampling</a></li>
<li><a class="reference internal" href="#dos-and-pdos">DOS and PDOS</a></li>
<li><a class="reference internal" href="#thermal-properties">Thermal properties</a></li>
<li><a class="reference internal" href="#non-analytical-term-correction">Non-analytical term correction</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-structure">Data structure</a><ul>
<li><a class="reference internal" href="#eigenvectors">Eigenvectors</a><ul>
<li><a class="reference internal" href="#id1">Band structure</a></li>
<li><a class="reference internal" href="#id2">Mesh sampling</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#phonopyatoms-class"><code class="docutils literal notranslate"><span class="pre">PhonopyAtoms</span></code> class</a><ul>
<li><a class="reference internal" href="#initialization">Initialization</a></li>
<li><a class="reference internal" href="#variables">Variables</a><ul>
<li><a class="reference internal" href="#lattice-vectors"><code class="docutils literal notranslate"><span class="pre">lattice_vectors</span></code></a></li>
<li><a class="reference internal" href="#scaled-positions"><code class="docutils literal notranslate"><span class="pre">scaled_positions</span></code></a></li>
<li><a class="reference internal" href="#positions"><code class="docutils literal notranslate"><span class="pre">positions</span></code></a></li>
<li><a class="reference internal" href="#symbols"><code class="docutils literal notranslate"><span class="pre">symbols</span></code></a></li>
<li><a class="reference internal" href="#numbers"><code class="docutils literal notranslate"><span class="pre">numbers</span></code></a></li>
<li><a class="reference internal" href="#masses"><code class="docutils literal notranslate"><span class="pre">masses</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#methods">Methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#definitions-of-variables">Definitions of variables</a><ul>
<li><a class="reference internal" href="#primitive-matrix">Primitive matrix</a></li>
<li><a class="reference internal" href="#supercell-matrix">Supercell matrix</a></li>
<li><a class="reference internal" href="#symmetry-search-tolerance">Symmetry search tolerance</a></li>
</ul>
</li>
<li><a class="reference internal" href="#getting-parameters-for-non-analytical-term-correction">Getting parameters for non-analytical term correction</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="external-tools.html" title="Previous Chapter: External tools"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; External tools</span>
    </a>
  </li>
  <li>
    <a href="formulation.html" title="Next Chapter: Formulations"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Formulations &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="phonopy-api-for-python">
<span id="phonopy-module"></span><h1>Phonopy API for Python<a class="headerlink" href="#phonopy-api-for-python" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#import-modules" id="id3">Import modules</a></p></li>
<li><p><a class="reference internal" href="#work-flow" id="id4">Work flow</a></p>
<ul>
<li><p><a class="reference internal" href="#pre-process" id="id5">Pre-process</a></p></li>
<li><p><a class="reference internal" href="#post-process" id="id6">Post process</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#phonon-calculation" id="id7">Phonon calculation</a></p>
<ul>
<li><p><a class="reference internal" href="#save-parameters-phonopy-save" id="id8">Save parameters (<code class="docutils literal notranslate"><span class="pre">phonopy.save</span></code>)</a></p></li>
<li><p><a class="reference internal" href="#shortcut-to-load-input-files-phonopy-load" id="id9">Shortcut to load input files (<code class="docutils literal notranslate"><span class="pre">phonopy.load</span></code>)</a></p></li>
<li><p><a class="reference internal" href="#band-structure" id="id10">Band structure</a></p></li>
<li><p><a class="reference internal" href="#mesh-sampling" id="id11">Mesh sampling</a></p></li>
<li><p><a class="reference internal" href="#dos-and-pdos" id="id12">DOS and PDOS</a></p></li>
<li><p><a class="reference internal" href="#thermal-properties" id="id13">Thermal properties</a></p></li>
<li><p><a class="reference internal" href="#non-analytical-term-correction" id="id14">Non-analytical term correction</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#data-structure" id="id15">Data structure</a></p>
<ul>
<li><p><a class="reference internal" href="#eigenvectors" id="id16">Eigenvectors</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#phonopyatoms-class" id="id17"><code class="docutils literal notranslate"><span class="pre">PhonopyAtoms</span></code> class</a></p>
<ul>
<li><p><a class="reference internal" href="#initialization" id="id18">Initialization</a></p></li>
<li><p><a class="reference internal" href="#variables" id="id19">Variables</a></p></li>
<li><p><a class="reference internal" href="#methods" id="id20">Methods</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#definitions-of-variables" id="id21">Definitions of variables</a></p>
<ul>
<li><p><a class="reference internal" href="#primitive-matrix" id="id22">Primitive matrix</a></p></li>
<li><p><a class="reference internal" href="#supercell-matrix" id="id23">Supercell matrix</a></p></li>
<li><p><a class="reference internal" href="#symmetry-search-tolerance" id="id24">Symmetry search tolerance</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#getting-parameters-for-non-analytical-term-correction" id="id25">Getting parameters for non-analytical term correction</a></p></li>
</ul>
</div>
<p><strong>This is under development. Configurations may alter.</strong> Requests or
suggestions are very welcome.</p>
<div class="section" id="import-modules">
<h2><a class="toc-backref" href="#id3">Import modules</a><a class="headerlink" href="#import-modules" title="Permalink to this headline">¶</a></h2>
<p>After setting the phonopy python path, the phonopy module is imported by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">phonopy</span> <span class="k">import</span> <span class="n">Phonopy</span>
</pre></div>
</div>
<p>Crystal structure is defined by the <code class="docutils literal notranslate"><span class="pre">PhonopyAtoms</span></code> class. This
class is made to be similar to the ASE’s <code class="docutils literal notranslate"><span class="pre">Atoms</span></code>
class. The <code class="docutils literal notranslate"><span class="pre">PhonopyAtoms</span></code> module is imported by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">phonopy.structure.atoms</span> <span class="k">import</span> <span class="n">PhonopyAtoms</span>
</pre></div>
</div>
</div>
<div class="section" id="work-flow">
<h2><a class="toc-backref" href="#id4">Work flow</a><a class="headerlink" href="#work-flow" title="Permalink to this headline">¶</a></h2>
<p>The work flow is schematically shown in <a class="reference internal" href="workflow.html#workflow"><span class="std std-ref">Work flow</span></a>.</p>
<div class="section" id="pre-process">
<h3><a class="toc-backref" href="#id5">Pre-process</a><a class="headerlink" href="#pre-process" title="Permalink to this headline">¶</a></h3>
<p>The first step is to create a <code class="docutils literal notranslate"><span class="pre">Phonopy</span></code> object with at least two
arguments, a unit cell (<code class="docutils literal notranslate"><span class="pre">PhonopyAtoms</span></code> object, see
<a class="reference internal" href="#phonopy-atoms"><span class="std std-ref">PhonopyAtoms class</span></a>) and a supercell matrix (3x3 array, see
<a class="reference internal" href="#variable-supercell-matrix"><span class="std std-ref">Supercell matrix</span></a>). In the following example, a
<span class="math notranslate nohighlight">\(2\times 2\times 2\)</span> supercell is created. The displacements to
be introduced to the supercell are internally generated by the
<code class="docutils literal notranslate"><span class="pre">generate_displacements()</span></code> method with the <code class="docutils literal notranslate"><span class="pre">distance</span></code> keyword
argument. The supercells with displacements are obtained by
<code class="docutils literal notranslate"><span class="pre">get_supercells_with_displacements()</span></code> method as a list of
<code class="docutils literal notranslate"><span class="pre">PhonopyAtoms</span></code> objects.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">phonopy</span> <span class="k">import</span> <span class="n">Phonopy</span>
<span class="kn">from</span> <span class="nn">phonopy.structure.atoms</span> <span class="k">import</span> <span class="n">PhonopyAtoms</span>

<span class="n">a</span> <span class="o">=</span> <span class="mf">5.404</span>
<span class="n">unitcell</span> <span class="o">=</span> <span class="n">PhonopyAtoms</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Si&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span><span class="p">,</span>
                        <span class="n">cell</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span><span class="p">),</span>
                        <span class="n">scaled_positions</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                          <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                          <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                          <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                          <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">],</span>
                                          <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">],</span>
                                          <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">],</span>
                                          <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">]])</span>
<span class="n">phonon</span> <span class="o">=</span> <span class="n">Phonopy</span><span class="p">(</span><span class="n">unitcell</span><span class="p">,</span>
                 <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
                 <span class="n">primitive_matrix</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="n">phonon</span><span class="o">.</span><span class="n">generate_displacements</span><span class="p">(</span><span class="n">distance</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span>
<span class="n">supercells</span> <span class="o">=</span> <span class="n">phonon</span><span class="o">.</span><span class="n">supercells_with_displacements</span>
</pre></div>
</div>
<p>In this example, the displacement distance is set to 0.03 (in Angstrom
if the crystal structure uses the Angstrom unit and the default value
is 0.01.)</p>
<p>The frequency unit conversion factor to THz has to be set by using the
<code class="docutils literal notranslate"><span class="pre">factor</span></code> keyword in <code class="docutils literal notranslate"><span class="pre">Phonopy</span></code> class. The factors are <code class="docutils literal notranslate"><span class="pre">VaspToTHz</span></code>
for VASP, <code class="docutils literal notranslate"><span class="pre">Wien2kToTHz</span></code> for Wien2k, <code class="docutils literal notranslate"><span class="pre">AbinitToTHz</span></code> for Abinit,
<code class="docutils literal notranslate"><span class="pre">PwscfToTHz</span></code> for Pwscf, <code class="docutils literal notranslate"><span class="pre">ElkToTHz</span></code> for Elk, <code class="docutils literal notranslate"><span class="pre">SiestaToTHz</span></code> for
Siesta, <code class="docutils literal notranslate"><span class="pre">CrystalToTHz</span></code> for CRYSTAL <code class="docutils literal notranslate"><span class="pre">VaspToTHz</span></code>, and <code class="docutils literal notranslate"><span class="pre">DftbpToTHz</span></code>
for DFTB+ is the default value.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">phonopy.units</span> <span class="k">import</span> <span class="n">AbinitToTHz</span>

<span class="n">phonon</span> <span class="o">=</span> <span class="n">Phonopy</span><span class="p">(</span><span class="n">unitcell</span><span class="p">,</span>
                 <span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
                 <span class="n">primitive_matrix</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                                   <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                 <span class="n">factor</span><span class="o">=</span><span class="n">AbinitToTHz</span><span class="p">)</span>
</pre></div>
</div>
<p>Some more information on physical unit conversion is found at
<a class="reference internal" href="setting-tags.html#frequency-conversion-factor-tag"><span class="std std-ref">FREQUENCY_CONVERSION_FACTOR</span></a>,
<a class="reference internal" href="formulation.html#physical-unit-conversion"><span class="std std-ref">Physical unit conversion</span></a>, and <a class="reference internal" href="interfaces.html#calculator-interfaces"><span class="std std-ref">Interfaces to calculators</span></a>.</p>
</div>
<div class="section" id="post-process">
<h3><a class="toc-backref" href="#id6">Post process</a><a class="headerlink" href="#post-process" title="Permalink to this headline">¶</a></h3>
<p>Forces on atoms are supposed to be obtained by running force
calculator (e.g. VASP) with each supercell with a displacement. Then
the forces in the calculation outputs have to be collected by
users. However output parsers for selected calculators are found under
<code class="docutils literal notranslate"><span class="pre">phonopy.interface</span></code>, which may be useful. The forces have to be
stored in a specific structure: a numpy array (or nested list) as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">[</span> <span class="p">[</span> <span class="n">f_1x</span><span class="p">,</span> <span class="n">f_1y</span><span class="p">,</span> <span class="n">f_1z</span> <span class="p">],</span> <span class="p">[</span> <span class="n">f_2x</span><span class="p">,</span> <span class="n">f_2y</span><span class="p">,</span> <span class="n">f_2z</span> <span class="p">],</span> <span class="o">...</span> <span class="p">],</span> <span class="c1"># first supercell</span>
  <span class="p">[</span> <span class="p">[</span> <span class="n">f_1x</span><span class="p">,</span> <span class="n">f_1y</span><span class="p">,</span> <span class="n">f_1z</span> <span class="p">],</span> <span class="p">[</span> <span class="n">f_2x</span><span class="p">,</span> <span class="n">f_2y</span><span class="p">,</span> <span class="n">f_2z</span> <span class="p">],</span> <span class="o">...</span> <span class="p">],</span> <span class="c1"># second supercell</span>
  <span class="o">...</span>                                                   <span class="p">]</span>
</pre></div>
</div>
<p>This array (<code class="docutils literal notranslate"><span class="pre">sets_of_forces</span></code>) is set to the <code class="docutils literal notranslate"><span class="pre">Phonopy</span></code> object by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span><span class="o">.</span><span class="n">set_forces</span><span class="p">(</span><span class="n">sets_of_forces</span><span class="p">)</span>
</pre></div>
</div>
<p>This is the case when the set of atomic displacements is generated
internally. The information of displacements is already stored in the
<code class="docutils literal notranslate"><span class="pre">Phonopy</span></code> object. But if you want to input the forces together with
the corresponding custom set of displacements,
<code class="docutils literal notranslate"><span class="pre">displacement_dataset</span></code> has to be prepared as a python dictionary as
follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">displacement_dataset</span> <span class="o">=</span>
   <span class="p">{</span><span class="s1">&#39;natom&#39;</span><span class="p">:</span> <span class="n">number_of_atoms_in_supercell</span><span class="p">,</span>
    <span class="s1">&#39;first_atoms&#39;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span><span class="s1">&#39;number&#39;</span><span class="p">:</span> <span class="n">atom</span> <span class="n">index</span> <span class="n">of</span> <span class="n">displaced</span> <span class="n">atom</span> <span class="p">(</span><span class="n">starting</span> <span class="k">with</span> <span class="mi">0</span><span class="p">),</span>
       <span class="s1">&#39;displacement&#39;</span><span class="p">:</span> <span class="n">displacement</span> <span class="ow">in</span> <span class="n">Cartesian</span> <span class="n">coordinates</span><span class="p">,</span>
       <span class="s1">&#39;forces&#39;</span><span class="p">:</span> <span class="n">forces</span> <span class="n">on</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">supercell</span><span class="p">},</span>
      <span class="p">{</span><span class="o">...</span><span class="p">},</span> <span class="o">...</span><span class="p">]}</span>
</pre></div>
</div>
<p>This is set to the <code class="docutils literal notranslate"><span class="pre">Phonopy</span></code> object by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonopy</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">displacement_dataset</span>
</pre></div>
</div>
<p>From the set of displacements and forces, force constants internally
with calculated suuprcell sets of forces by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span><span class="o">.</span><span class="n">produce_force_constants</span><span class="p">()</span>
</pre></div>
</div>
<p>If you have force constants and don’t need to create force constants
from forces and displacements, simply set your force constants by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span><span class="o">.</span><span class="n">force_constants</span> <span class="o">=</span> <span class="n">force_constants</span>
</pre></div>
</div>
<p>The force constants matrix is given in 4 dimensional array (better to
be a numpy array of <code class="docutils literal notranslate"><span class="pre">dtype='double',</span> <span class="pre">order='C'</span></code>).  The shape of
force constants matrix is <code class="docutils literal notranslate"><span class="pre">(N,</span> <span class="pre">N,</span> <span class="pre">3,</span> <span class="pre">3)</span></code> where <code class="docutils literal notranslate"><span class="pre">N</span></code> is the number
of atoms in the supercell and 3 gives Cartesian axes.  The compact
force constants matrix with <code class="docutils literal notranslate"><span class="pre">(Np,</span> <span class="pre">N,</span> <span class="pre">3,</span> <span class="pre">3)</span></code> where <code class="docutils literal notranslate"><span class="pre">Np</span></code> is the
number of atoms in the primitive cell is also supported. See the
details at <a class="reference internal" href="input-files.html#file-force-constants"><span class="std std-ref">FORCE_CONSTANTS and force_constants.hdf5</span></a>.</p>
</div>
</div>
<div class="section" id="phonon-calculation">
<h2><a class="toc-backref" href="#id7">Phonon calculation</a><a class="headerlink" href="#phonon-calculation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="save-parameters-phonopy-save">
<span id="phonopy-save-parameters"></span><h3><a class="toc-backref" href="#id8">Save parameters (<code class="docutils literal notranslate"><span class="pre">phonopy.save</span></code>)</a><a class="headerlink" href="#save-parameters-phonopy-save" title="Permalink to this headline">¶</a></h3>
<p>Basic information and parameters needed for phonon calculation are
saved into a file by <code class="docutils literal notranslate"><span class="pre">phonopy.save</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>The default file name is <code class="docutils literal notranslate"><span class="pre">phonopy_params.yaml</span></code>. Force sets,
displacements, Born effective charges, and dielectric constant are
written in the default behaviour. If force constants are needed to be
written in the yaml file, the argument <code class="docutils literal notranslate"><span class="pre">settings</span></code> is set as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">settings</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;force_constants&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="shortcut-to-load-input-files-phonopy-load">
<h3><a class="toc-backref" href="#id9">Shortcut to load input files (<code class="docutils literal notranslate"><span class="pre">phonopy.load</span></code>)</a><a class="headerlink" href="#shortcut-to-load-input-files-phonopy-load" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">phonopy.load</span></code> is a convenient python method to create <code class="docutils literal notranslate"><span class="pre">Phonopy</span></code>
instance loading forces, displacements, and parameters for
non-analytical term correction. The details are found in the docstring
that can be seen by (e.g., in ipython)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">phonopy</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">help</span><span class="p">(</span><span class="n">phonopy</span><span class="o">.</span><span class="n">load</span><span class="p">)</span>
</pre></div>
</div>
<p>Examples of how to use <code class="docutils literal notranslate"><span class="pre">phonopy.load</span></code> are listed below.</p>
<p><code class="docutils literal notranslate"><span class="pre">phonopy-params.yaml</span></code> may contain all information needed to prepare
phonon calculation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span> <span class="o">=</span> <span class="n">phonopy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;phonopy-params.yaml&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>More detailed configuration can be given as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span> <span class="o">=</span> <span class="n">phonopy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">supercell_matrix</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                      <span class="n">primitive_matrix</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                      <span class="n">unitcell_filename</span><span class="o">=</span><span class="s2">&quot;POSCAR&quot;</span><span class="p">,</span>
                      <span class="n">force_constants_filename</span><span class="o">=</span><span class="s2">&quot;force_constants.hdf5&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>With <code class="docutils literal notranslate"><span class="pre">is_nac=True</span></code> (default), <code class="docutils literal notranslate"><span class="pre">BORN</span></code> file in the current directory
is read if it exists. If supercell is passed and <code class="docutils literal notranslate"><span class="pre">primitive</span> <span class="pre">matrix</span></code>
and <code class="docutils literal notranslate"><span class="pre">supercell_matrix</span></code> are not set, the primitive cell is
automatically searched:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span> <span class="o">=</span> <span class="n">phonopy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">supercell_filename</span><span class="o">=</span><span class="s2">&quot;SPOSCAR&quot;</span><span class="p">,</span>
                      <span class="n">force_constants_filename</span><span class="o">=</span><span class="s2">&quot;force_constants.hdf5&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">FORCE_SETS</span></code> exists in the current directory, this below works to
be ready for post-process calculation with automatic choice of
primitive matrix:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span> <span class="o">=</span> <span class="n">phonopy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">supercell_filename</span><span class="o">=</span><span class="s2">&quot;SPOSCAR&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>For example, in the <code class="docutils literal notranslate"><span class="pre">example/NaCl</span></code> directory, phonon band structure
of NaCl is easily plotted by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">phonopy</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">ph</span> <span class="o">=</span> <span class="n">phonopy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">supercell_filename</span><span class="o">=</span><span class="s2">&quot;SPOSCAR&quot;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">ph</span><span class="o">.</span><span class="n">primitive</span><span class="p">)</span>
<span class="n">lattice</span><span class="p">:</span>
<span class="o">-</span> <span class="p">[</span>     <span class="mf">0.000000000000000</span><span class="p">,</span>     <span class="mf">2.845150738087836</span><span class="p">,</span>     <span class="mf">2.845150738087836</span> <span class="p">]</span> <span class="c1"># a</span>
<span class="o">-</span> <span class="p">[</span>     <span class="mf">2.845150738087836</span><span class="p">,</span>     <span class="mf">0.000000000000000</span><span class="p">,</span>     <span class="mf">2.845150738087836</span> <span class="p">]</span> <span class="c1"># b</span>
<span class="o">-</span> <span class="p">[</span>     <span class="mf">2.845150738087836</span><span class="p">,</span>     <span class="mf">2.845150738087836</span><span class="p">,</span>     <span class="mf">0.000000000000000</span> <span class="p">]</span> <span class="c1"># c</span>
<span class="n">points</span><span class="p">:</span>
<span class="o">-</span> <span class="n">symbol</span><span class="p">:</span> <span class="n">Na</span> <span class="c1"># 1</span>
  <span class="n">coordinates</span><span class="p">:</span> <span class="p">[</span>  <span class="mf">0.000000000000000</span><span class="p">,</span>  <span class="mf">0.000000000000000</span><span class="p">,</span>  <span class="mf">0.000000000000000</span> <span class="p">]</span>
  <span class="n">mass</span><span class="p">:</span> <span class="mf">22.989769</span>
<span class="o">-</span> <span class="n">symbol</span><span class="p">:</span> <span class="n">Cl</span> <span class="c1"># 2</span>
  <span class="n">coordinates</span><span class="p">:</span> <span class="p">[</span>  <span class="mf">0.500000000000000</span><span class="p">,</span>  <span class="mf">0.500000000000000</span><span class="p">,</span>  <span class="mf">0.500000000000000</span> <span class="p">]</span>
  <span class="n">mass</span><span class="p">:</span> <span class="mf">35.453000</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">ph</span><span class="o">.</span><span class="n">nac_params</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;born&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([[[</span> <span class="mf">1.08703</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">1.08703</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">1.08703</span><span class="p">]],</span>

       <span class="p">[[</span><span class="o">-</span><span class="mf">1.08672</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">1.08672</span><span class="p">,</span>  <span class="mf">0.</span>     <span class="p">],</span>
        <span class="p">[</span> <span class="mf">0.</span>     <span class="p">,</span>  <span class="mf">0.</span>     <span class="p">,</span> <span class="o">-</span><span class="mf">1.08672</span><span class="p">]]]),</span> <span class="s1">&#39;factor&#39;</span><span class="p">:</span> <span class="mf">14.4</span><span class="p">,</span> <span class="s1">&#39;dielectric&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([[</span><span class="mf">2.43533967</span><span class="p">,</span> <span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">],</span>
       <span class="p">[</span><span class="mf">0.</span>        <span class="p">,</span> <span class="mf">2.43533967</span><span class="p">,</span> <span class="mf">0.</span>        <span class="p">],</span>
       <span class="p">[</span><span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.</span>        <span class="p">,</span> <span class="mf">2.43533967</span><span class="p">]])}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">ph</span><span class="o">.</span><span class="n">auto_band_structure</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="band-structure">
<h3><a class="toc-backref" href="#id10">Band structure</a><a class="headerlink" href="#band-structure" title="Permalink to this headline">¶</a></h3>
<p>Set band paths (<code class="docutils literal notranslate"><span class="pre">run_band_structure()</span></code>) and get the results
(<code class="docutils literal notranslate"><span class="pre">get_band_structure_dict()</span></code>).</p>
<p>A dictionary with <code class="docutils literal notranslate"><span class="pre">qpoints</span></code>, <code class="docutils literal notranslate"><span class="pre">distances</span></code>, <code class="docutils literal notranslate"><span class="pre">frequencies</span></code>,
<code class="docutils literal notranslate"><span class="pre">eigenvectors</span></code>, <code class="docutils literal notranslate"><span class="pre">group_velocities</span></code> is returned by
<code class="docutils literal notranslate"><span class="pre">get_band_structure_dict()</span></code>. Eigenvectors can be obtained when
<code class="docutils literal notranslate"><span class="pre">with_eigenvectors=True</span></code> at <code class="docutils literal notranslate"><span class="pre">run_band_structure()</span></code>. See the
details at docstring of <code class="docutils literal notranslate"><span class="pre">Phonopy.get_band_structure_dict</span></code>. Phonon
frequency is sqrt(eigenvalue). A negative eigenvalue has to correspond
to the imaginary frequency, but for the plotting, it is set as the
negative value in the above example. In addition, you need to multiply
by your unit conversion factor. In the case of VASP to transform to
THz, the factor is 15.633302.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">example/NaCl</span></code>, the phonopy is executed from python script, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">phonopy</span>
<span class="kn">from</span> <span class="nn">phonopy.phonon.band_structure</span> <span class="k">import</span> <span class="n">get_band_qpoints_and_path_connections</span>

<span class="n">path</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.625</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.625</span><span class="p">]],</span>
        <span class="p">[[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">]]]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">Gamma$&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">Gamma$&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">]</span>
<span class="n">qpoints</span><span class="p">,</span> <span class="n">connections</span> <span class="o">=</span> <span class="n">get_band_qpoints_and_path_connections</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">npoints</span><span class="o">=</span><span class="mi">51</span><span class="p">)</span>
<span class="n">phonon</span> <span class="o">=</span> <span class="n">phonopy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">unitcell_filename</span><span class="o">=</span><span class="s2">&quot;POSCAR&quot;</span><span class="p">,</span>
                      <span class="n">supercell_matrix</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                      <span class="n">primitive_matrix</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
<span class="n">phonon</span><span class="o">.</span><span class="n">run_band_structure</span><span class="p">(</span><span class="n">qpoints</span><span class="p">,</span> <span class="n">path_connections</span><span class="o">=</span><span class="n">connections</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
<span class="n">phonon</span><span class="o">.</span><span class="n">plot_band_structure</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># To plot DOS next to band structure</span>
<span class="n">phonon</span><span class="o">.</span><span class="n">run_mesh</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
<span class="n">phonon</span><span class="o">.</span><span class="n">run_total_dos</span><span class="p">()</span>
<span class="n">phonon</span><span class="o">.</span><span class="n">plot_band_structure_and_dos</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># To plot PDOS next to band structure</span>
<span class="n">phonon</span><span class="o">.</span><span class="n">run_mesh</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="n">with_eigenvectors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">is_mesh_symmetry</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">phonon</span><span class="o">.</span><span class="n">plot_band_structure_and_dos</span><span class="p">(</span><span class="n">pdos_indices</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">path_connections</span></code> and <code class="docutils literal notranslate"><span class="pre">labels</span></code> are unnecessary to set unless nice
looking plotting is needed. To obtain eigenvectors, it is necessary to
inform to store eigenvectors by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span><span class="o">.</span><span class="n">run_band_structure</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="n">with_eigenvectors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>To obtain group velocities:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span><span class="o">.</span><span class="n">run_band_structure</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="n">with_group_velocities</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Automatic selection of band paths using <a class="reference external" href="https://seekpath.readthedocs.io/en/latest/">SeeK-path</a> is invoked by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span><span class="o">.</span><span class="n">auto_band_structure</span><span class="p">()</span>
</pre></div>
</div>
<p>and to plot</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span><span class="o">.</span><span class="n">auto_band_structure</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>To use this method, <code class="docutils literal notranslate"><span class="pre">seekpath</span></code> python module is needed.</p>
</div>
<div class="section" id="mesh-sampling">
<h3><a class="toc-backref" href="#id11">Mesh sampling</a><a class="headerlink" href="#mesh-sampling" title="Permalink to this headline">¶</a></h3>
<p>Set sampling mesh (<code class="docutils literal notranslate"><span class="pre">set_mesh</span></code>) in reciprocal space. The irreducible
<em>q</em>-points and corresponding <em>q</em>-point weights, eigenvalues, and
eigenvectors are obtained by <code class="docutils literal notranslate"><span class="pre">get_mesh_dict()</span></code>.  <code class="docutils literal notranslate"><span class="pre">mesh</span></code> gives the
sampling mesh with Monkhorst-Pack scheme. The keyword <code class="docutils literal notranslate"><span class="pre">shift</span></code> gives
the fractional mesh shift with respect to the neighboring grid points.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mesh</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<span class="n">phonon</span><span class="o">.</span><span class="n">run_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
<span class="n">mesh_dict</span> <span class="o">=</span> <span class="n">phonon</span><span class="o">.</span><span class="n">get_mesh_dict</span><span class="p">()</span>
<span class="n">qpoints</span> <span class="o">=</span> <span class="n">mesh_dict</span><span class="p">[</span><span class="s1">&#39;qpoints&#39;</span><span class="p">]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">mesh_dict</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span>
<span class="n">frequencies</span> <span class="o">=</span> <span class="n">mesh_dict</span><span class="p">[</span><span class="s1">&#39;frequencies&#39;</span><span class="p">]</span>
<span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">mesh_dict</span><span class="p">[</span><span class="s1">&#39;eigenvectors&#39;</span><span class="p">]</span>
<span class="n">group_velocities</span> <span class="o">=</span> <span class="n">mesh_dict</span><span class="p">[</span><span class="s1">&#39;group_velocities&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>To obtain eigenvectors, it is necessary to inform to store
eigenvectors by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span><span class="o">.</span><span class="n">run_mesh</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="n">with_eigenvectors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>and for group velocities:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span><span class="o">.</span><span class="n">run_mesh</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="n">with_group_velocities</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The first argument of <code class="docutils literal notranslate"><span class="pre">run_mesh()</span></code> can be a float value, which is a
length measure as explained at <a class="reference internal" href="setting-tags.html#mp-tag"><span class="std std-ref">MESH, MP, or MESH_NUMBERS</span></a>, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span><span class="o">.</span><span class="n">run_mesh</span><span class="p">(</span><span class="mf">100.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="dos-and-pdos">
<h3><a class="toc-backref" href="#id12">DOS and PDOS</a><a class="headerlink" href="#dos-and-pdos" title="Permalink to this headline">¶</a></h3>
<p>Before starting mesh sampling has to be finished. Then set parameters
(<code class="docutils literal notranslate"><span class="pre">run_total_dos()</span></code> or <code class="docutils literal notranslate"><span class="pre">run_projected_dos()</span></code>) and write the results into
files (<code class="docutils literal notranslate"><span class="pre">write_total_dos()</span></code> and <code class="docutils literal notranslate"><span class="pre">write_projected_dos()</span></code>). In the case of
PDOS, the eigenvectors have to be calculated in the mesh
sampling. To get the results <code class="docutils literal notranslate"><span class="pre">get_total_dos_dict()</span></code> and
<code class="docutils literal notranslate"><span class="pre">get_projected_dos_dict()</span></code> can be used.</p>
<p>To plot total DOS,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span><span class="o">.</span><span class="n">run_mesh</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
<span class="n">phonon</span><span class="o">.</span><span class="n">run_total_dos</span><span class="p">()</span>
<span class="n">phonon</span><span class="o">.</span><span class="n">plot_total_dos</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>and projected DOS</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span><span class="o">.</span><span class="n">run_mesh</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="n">with_eigenvectors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">is_mesh_symmetry</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">phonon</span><span class="o">.</span><span class="n">run_projected_dos</span><span class="p">()</span>
<span class="n">phonon</span><span class="o">.</span><span class="n">plot_projected_dos</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Convenient shortcuts exist as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span><span class="o">.</span><span class="n">auto_total_dos</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span><span class="o">.</span><span class="n">auto_projected_dos</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="thermal-properties">
<h3><a class="toc-backref" href="#id13">Thermal properties</a><a class="headerlink" href="#thermal-properties" title="Permalink to this headline">¶</a></h3>
<p>Before starting the thermal property calculation, the mesh sampling
calclation has to be done in the <strong>THz unit</strong>. The unit conversion
factor for phonon frequency is set in the pre-process of Phonopy with
the <code class="docutils literal notranslate"><span class="pre">factor</span></code> keyword. Calculation range of temperature is set by the
parameters <code class="docutils literal notranslate"><span class="pre">run_thermal_properties</span></code>. Helmholtz free energy, entropy,
heat capacity at contant volume at temperaturs are obtained by
<code class="docutils literal notranslate"><span class="pre">get_thermal_properties_dict</span></code>, where the results are given as a
dictionary of temperaturs, Helmholtz free energy, entropy, and heat
capacity with keys <code class="docutils literal notranslate"><span class="pre">temperatures</span></code>, <code class="docutils literal notranslate"><span class="pre">free_energy</span></code>, <code class="docutils literal notranslate"><span class="pre">entropy</span></code>, and
<code class="docutils literal notranslate"><span class="pre">heat_capacity</span></code>, respectively.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonon</span><span class="o">.</span><span class="n">run_mesh</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
<span class="n">phonon</span><span class="o">.</span><span class="n">run_thermal_properties</span><span class="p">(</span><span class="n">t_step</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                              <span class="n">t_max</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                              <span class="n">t_min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">tp_dict</span> <span class="o">=</span> <span class="n">phonon</span><span class="o">.</span><span class="n">get_thermal_properties_dict</span><span class="p">()</span>
<span class="n">temperatures</span> <span class="o">=</span> <span class="n">tp_dict</span><span class="p">[</span><span class="s1">&#39;temperatures&#39;</span><span class="p">]</span>
<span class="n">free_energy</span> <span class="o">=</span> <span class="n">tp_dict</span><span class="p">[</span><span class="s1">&#39;free_energy&#39;</span><span class="p">]</span>
<span class="n">entropy</span> <span class="o">=</span> <span class="n">tp_dict</span><span class="p">[</span><span class="s1">&#39;entropy&#39;</span><span class="p">]</span>
<span class="n">heat_capacity</span> <span class="o">=</span> <span class="n">tp_dict</span><span class="p">[</span><span class="s1">&#39;heat_capacity&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">temperatures</span><span class="p">,</span> <span class="n">free_energy</span><span class="p">,</span> <span class="n">entropy</span><span class="p">,</span> <span class="n">heat_capacity</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">%12.3f</span><span class="s2"> &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%15.7f</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span> <span class="n">t</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">cv</span> <span class="p">))</span>

<span class="n">phonon</span><span class="o">.</span><span class="n">plot_thermal_properties</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="non-analytical-term-correction">
<h3><a class="toc-backref" href="#id14">Non-analytical term correction</a><a class="headerlink" href="#non-analytical-term-correction" title="Permalink to this headline">¶</a></h3>
<p>To apply non-analytical term correction, Born effective charge tensors
for all atoms in <strong>primitive</strong> cell, dielectric constant tensor, and
the unit conversion factor have to be correctly set. The tensors are
given in Cartesian coordinates.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">born</span> <span class="o">=</span> <span class="p">[[[</span><span class="mf">1.08878299</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.08878299</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.08878299</span><span class="p">]],</span>
        <span class="p">[[</span><span class="o">-</span><span class="mf">1.08878299</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.08878299</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
         <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.08878299</span><span class="p">]]]</span>
<span class="n">epsilon</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">2.56544559</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
           <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.56544559</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
           <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2.56544559</span><span class="p">]]</span>
<span class="n">factors</span> <span class="o">=</span> <span class="mf">14.400</span>
<span class="n">phonon</span><span class="o">.</span><span class="n">set_nac_params</span><span class="p">({</span><span class="s1">&#39;born&#39;</span><span class="p">:</span> <span class="n">born</span><span class="p">,</span>
                       <span class="s1">&#39;factor&#39;</span><span class="p">:</span> <span class="n">factors</span><span class="p">,</span>
                       <span class="s1">&#39;dielectric&#39;</span><span class="p">:</span> <span class="n">epsilon</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="data-structure">
<h2><a class="toc-backref" href="#id15">Data structure</a><a class="headerlink" href="#data-structure" title="Permalink to this headline">¶</a></h2>
<div class="section" id="eigenvectors">
<h3><a class="toc-backref" href="#id16">Eigenvectors</a><a class="headerlink" href="#eigenvectors" title="Permalink to this headline">¶</a></h3>
<p>Eigenvectors are given as the column vectors. Internally phonopy uses
numpy.linalg.eigh and eigh is a wrapper of LAPACK. So eigenvectors
follow the convention of LAPACK, which can be shown at
<a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.linalg.eigh.html">http://docs.scipy.org/doc/numpy/reference/generated/numpy.linalg.eigh.html</a></p>
<p>Eigenvectors corresponding to phonopy yaml output are obtained as follows.</p>
<div class="section" id="id1">
<h4>Band structure<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">eigvecs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">eigvecs_on_path</span> <span class="ow">in</span> <span class="n">eigvecs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">eigvecs_at_q</span> <span class="ow">in</span> <span class="n">eigvecs_on_path</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vec</span> <span class="ow">in</span> <span class="n">eigvecs_at_q</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
                <span class="nb">print</span> <span class="n">vec</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h4>Mesh sampling<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">eigvecs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">eigvecs_at_q</span> <span class="ow">in</span> <span class="n">eigvecs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">vec</span> <span class="ow">in</span> <span class="n">eigvecs_at_q</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
            <span class="nb">print</span> <span class="n">vec</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="phonopyatoms-class">
<span id="phonopy-atoms"></span><h2><a class="toc-backref" href="#id17"><code class="docutils literal notranslate"><span class="pre">PhonopyAtoms</span></code> class</a><a class="headerlink" href="#phonopyatoms-class" title="Permalink to this headline">¶</a></h2>
<div class="section" id="initialization">
<h3><a class="toc-backref" href="#id18">Initialization</a><a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h3>
<p>The usable keywords in the initialization are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="n">positions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="n">numbers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="n">masses</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="n">scaled_positions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="n">cell</span><span class="o">=</span><span class="kc">None</span>
</pre></div>
</div>
<p>At least three arguments have to be given at the initialization, which
are</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cell</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">positions</span></code> or <code class="docutils literal notranslate"><span class="pre">scaled_positions</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">symbols</span></code> or <code class="docutils literal notranslate"><span class="pre">numbers</span></code></p></li>
</ul>
</div>
<div class="section" id="variables">
<span id="phonopy-atoms-variables"></span><h3><a class="toc-backref" href="#id19">Variables</a><a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h3>
<p>The following variables are implemented in the <code class="docutils literal notranslate"><span class="pre">PhonopyAtoms</span></code> class
in <code class="docutils literal notranslate"><span class="pre">atoms.py</span></code>.</p>
<div class="section" id="lattice-vectors">
<span id="phonopy-atoms-cell"></span><h4><code class="docutils literal notranslate"><span class="pre">lattice_vectors</span></code><a class="headerlink" href="#lattice-vectors" title="Permalink to this headline">¶</a></h4>
<p>Lattice vectors are given in the matrix form in Cartesian coordinates.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">[</span> <span class="n">a_x</span><span class="p">,</span> <span class="n">a_y</span><span class="p">,</span> <span class="n">a_z</span> <span class="p">],</span>
  <span class="p">[</span> <span class="n">b_x</span><span class="p">,</span> <span class="n">b_y</span><span class="p">,</span> <span class="n">b_z</span> <span class="p">],</span>
  <span class="p">[</span> <span class="n">c_x</span><span class="p">,</span> <span class="n">c_y</span><span class="p">,</span> <span class="n">c_z</span> <span class="p">]</span> <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="scaled-positions">
<h4><code class="docutils literal notranslate"><span class="pre">scaled_positions</span></code><a class="headerlink" href="#scaled-positions" title="Permalink to this headline">¶</a></h4>
<p>Atomic positions in fractional coordinates.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">[</span> <span class="n">x1_a</span><span class="p">,</span> <span class="n">x1_b</span><span class="p">,</span> <span class="n">x1_c</span> <span class="p">],</span>
  <span class="p">[</span> <span class="n">x2_a</span><span class="p">,</span> <span class="n">x2_b</span><span class="p">,</span> <span class="n">x2_c</span> <span class="p">],</span>
  <span class="p">[</span> <span class="n">x3_a</span><span class="p">,</span> <span class="n">x3_b</span><span class="p">,</span> <span class="n">x3_c</span> <span class="p">],</span>
  <span class="o">...</span>                   <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="positions">
<h4><code class="docutils literal notranslate"><span class="pre">positions</span></code><a class="headerlink" href="#positions" title="Permalink to this headline">¶</a></h4>
<p>Cartesian positions of atoms.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">scaled_positions</span><span class="p">,</span> <span class="n">lattice_vectors</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">np</span></code> means the numpy module (<code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">numpy</span> <span class="pre">as</span> <span class="pre">np</span></code>).</p>
</div>
<div class="section" id="symbols">
<h4><code class="docutils literal notranslate"><span class="pre">symbols</span></code><a class="headerlink" href="#symbols" title="Permalink to this headline">¶</a></h4>
<p>Chemical symbols, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;Zn&#39;</span><span class="p">,</span> <span class="s1">&#39;Zn&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>for the ZnO unit cell.</p>
</div>
<div class="section" id="numbers">
<h4><code class="docutils literal notranslate"><span class="pre">numbers</span></code><a class="headerlink" href="#numbers" title="Permalink to this headline">¶</a></h4>
<p>Atomic numbers, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
</pre></div>
</div>
<p>for the ZnO unit cell.</p>
</div>
<div class="section" id="masses">
<h4><code class="docutils literal notranslate"><span class="pre">masses</span></code><a class="headerlink" href="#masses" title="Permalink to this headline">¶</a></h4>
<p>Atomic masses, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">65.38</span><span class="p">,</span> <span class="mf">65.38</span><span class="p">,</span> <span class="mf">15.9994</span><span class="p">,</span> <span class="mf">15.9994</span><span class="p">]</span>
</pre></div>
</div>
<p>for the ZnO unit cell.</p>
</div>
</div>
<div class="section" id="methods">
<h3><a class="toc-backref" href="#id20">Methods</a><a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">set_cell</span><span class="p">(</span><span class="n">lattice_vectors</span><span class="p">)</span>
<span class="n">get_cell</span><span class="p">()</span>
<span class="n">set_positions</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
<span class="n">get_positions</span><span class="p">()</span>
<span class="n">set_scaled_positions</span><span class="p">(</span><span class="n">scaled_positions</span><span class="p">)</span>
<span class="n">get_scaled_positions</span><span class="p">()</span>
<span class="n">set_masses</span><span class="p">(</span><span class="n">masses</span><span class="p">)</span>
<span class="n">get_masses</span><span class="p">()</span>
<span class="n">set_chemical_symbols</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>
<span class="n">get_chemical_symbols</span><span class="p">()</span>
<span class="n">get_number_of_atoms</span><span class="p">()</span>
<span class="n">get_atomic_numbers</span><span class="p">()</span>
<span class="n">get_volume</span><span class="p">()</span>
</pre></div>
</div>
<p>These methods are designed to be compatible to the ASE’s <code class="docutils literal notranslate"><span class="pre">Atoms</span></code>
class. The arguments have to be set in the structures shown in
<a class="reference internal" href="#phonopy-atoms-variables"><span class="std std-ref">Variables</span></a>.</p>
</div>
</div>
<div class="section" id="definitions-of-variables">
<h2><a class="toc-backref" href="#id21">Definitions of variables</a><a class="headerlink" href="#definitions-of-variables" title="Permalink to this headline">¶</a></h2>
<div class="section" id="primitive-matrix">
<span id="variable-primitive-matrix"></span><h3><a class="toc-backref" href="#id22">Primitive matrix</a><a class="headerlink" href="#primitive-matrix" title="Permalink to this headline">¶</a></h3>
<p>Primitive matrix <span class="math notranslate nohighlight">\(M_\mathrm{p}\)</span> is a tranformation matrix from
lattice vectors to those of a primitive cell if there exists the
primitive cell in the lattice vectors. Following a crystallography
convention, the transformation is given by</p>
<div class="math notranslate nohighlight">
\[( \mathbf{a}_\mathrm{p} \; \mathbf{b}_\mathrm{p} \; \mathbf{c}_\mathrm{p} )
=  ( \mathbf{a}_\mathrm{u} \; \mathbf{b}_\mathrm{u} \;
\mathbf{c}_\mathrm{u} ) M_\mathrm{p}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{a}_\mathrm{u}\)</span>, <span class="math notranslate nohighlight">\(\mathbf{b}_\mathrm{u}\)</span>,
and <span class="math notranslate nohighlight">\(\mathbf{c}_\mathrm{u}\)</span> are the column vectors of the
original lattice vectors, and <span class="math notranslate nohighlight">\(\mathbf{a}_\mathrm{p}\)</span>,
<span class="math notranslate nohighlight">\(\mathbf{b}_\mathrm{p}\)</span>, and <span class="math notranslate nohighlight">\(\mathbf{c}_\mathrm{p}\)</span> are
the column vectors of the primitive lattice vectors. Be careful that
the lattice vectors of the <code class="docutils literal notranslate"><span class="pre">PhonopyAtoms</span></code> class are the row vectors
(<a class="reference internal" href="#phonopy-atoms-cell"><span class="std std-ref">lattice_vectors</span></a>). Therefore the phonopy code, which relies
on the <code class="docutils literal notranslate"><span class="pre">PhonopyAtoms</span></code> class, is usually written such as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">primitive_lattice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">original_lattice</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">primitive_matrix</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
</pre></div>
</div>
<p>or equivalently,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">primitive_lattice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">primitive_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">original_lattice</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="supercell-matrix">
<span id="variable-supercell-matrix"></span><h3><a class="toc-backref" href="#id23">Supercell matrix</a><a class="headerlink" href="#supercell-matrix" title="Permalink to this headline">¶</a></h3>
<p>Supercell matrix <span class="math notranslate nohighlight">\(M_\mathrm{s}\)</span> is a tranformation matrix from
lattice vectors to those of a super cell. Following a crystallography
convention, the transformation is given by</p>
<div class="math notranslate nohighlight">
\[( \mathbf{a}_\mathrm{s} \; \mathbf{b}_\mathrm{s} \; \mathbf{c}_\mathrm{s} )
=  ( \mathbf{a}_\mathrm{u} \; \mathbf{b}_\mathrm{u} \;
\mathbf{c}_\mathrm{u} ) M_\mathrm{s}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{a}_\mathrm{u}\)</span>, <span class="math notranslate nohighlight">\(\mathbf{b}_\mathrm{u}\)</span>,
and <span class="math notranslate nohighlight">\(\mathbf{c}_\mathrm{u}\)</span> are the column vectors of the
original lattice vectors, and <span class="math notranslate nohighlight">\(\mathbf{a}_\mathrm{s}\)</span>,
<span class="math notranslate nohighlight">\(\mathbf{b}_\mathrm{s}\)</span>, and <span class="math notranslate nohighlight">\(\mathbf{c}_\mathrm{s}\)</span> are
the column vectors of the supercell lattice vectors.  Be careful that
the lattice vectors of the <code class="docutils literal notranslate"><span class="pre">PhonopyAtoms</span></code> class are the row vectors
(<a class="reference internal" href="#phonopy-atoms-cell"><span class="std std-ref">lattice_vectors</span></a>). Therefore the phonopy code, which relies
on the <code class="docutils literal notranslate"><span class="pre">PhonopyAtoms</span></code> class, is usually written such as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">supercell_lattice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">original_lattice</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">supercell_matrix</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
</pre></div>
</div>
<p>or equivalently,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">supercell_lattice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">supercell_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">original_lattice</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="symmetry-search-tolerance">
<h3><a class="toc-backref" href="#id24">Symmetry search tolerance</a><a class="headerlink" href="#symmetry-search-tolerance" title="Permalink to this headline">¶</a></h3>
<p>Symmetry search tolerance (often the name <code class="docutils literal notranslate"><span class="pre">symprec</span></code> is used in
phonopy) is used to determine symmetry operations of the crystal
structures. The physical unit follows that of input crystal structure.</p>
</div>
</div>
<div class="section" id="getting-parameters-for-non-analytical-term-correction">
<h2><a class="toc-backref" href="#id25">Getting parameters for non-analytical term correction</a><a class="headerlink" href="#getting-parameters-for-non-analytical-term-correction" title="Permalink to this headline">¶</a></h2>
<p>Parameters for non-analytical term correction may be made as
follows. This example assumes that the user knows what are the unit
cell and primitive cell and that the Born effective charge and
dielectric constant were calculated using VASP code by the unit cell.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">phonopy.units</span> <span class="k">import</span> <span class="n">Hartree</span><span class="p">,</span> <span class="n">Bohr</span>
<span class="kn">from</span> <span class="nn">phonopy.structure.symmetry</span> <span class="k">import</span> <span class="n">symmetrize_borns_and_epsilon</span>
<span class="kn">from</span> <span class="nn">phonopy.interface.vasp</span> <span class="k">import</span> <span class="n">VasprunxmlExpat</span>

<span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;vasprun.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">vasprun</span> <span class="o">=</span> <span class="n">VasprunxmlExpat</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">parse</span><span class="p">():</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">epsilon</span>
        <span class="n">borns</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">born</span>
        <span class="n">unitcell</span> <span class="o">=</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">cell</span>

<span class="n">borns_</span><span class="p">,</span> <span class="n">epsilon_</span> <span class="o">=</span> <span class="n">symmetrize_borns_and_epsilon</span><span class="p">(</span>
    <span class="n">borns</span><span class="p">,</span>
    <span class="n">epsilon</span><span class="p">,</span>
    <span class="n">unitcell</span><span class="p">,</span>
    <span class="n">primitive_matrix</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                      <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                      <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
    <span class="n">supercell_matrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
    <span class="n">symprec</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>

<span class="n">nac_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;born&#39;</span><span class="p">:</span> <span class="n">borns_</span><span class="p">,</span>
              <span class="s1">&#39;factor&#39;</span><span class="p">:</span> <span class="n">Hartree</span> <span class="o">*</span> <span class="n">Bohr</span><span class="p">,</span>
              <span class="s1">&#39;dielectric&#39;</span><span class="p">:</span> <span class="n">epsilon_</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/phonopy-module.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2009, Atsushi Togo.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>