
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Temperature dependent force constants calculation using pypolymlp and symfc &#8212; Phonopy v.2.34.0</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=cec2c45e"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'mlp-sscha';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Formulations" href="formulation.html" />
    <link rel="prev" title="phonopy-load command" href="phonopy-load.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="2.34" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">Phonopy v.2.34.0</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="symmetry.html">Crystal symmetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Work flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="input-files.html">Input files</a></li>
<li class="toctree-l1"><a class="reference internal" href="output-files.html">Output files</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="setting-tags.html">Setting tags</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="animation.html">How to watch animation</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="command-options.html">Command options</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamic-structure-factor.html">Dynamic structure factor</a></li>
<li class="toctree-l1"><a class="reference internal" href="gruneisen.html">Mode Grüneisen parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="qha.html">Quasi harmonic approximation</a></li>
<li class="toctree-l1"><a class="reference internal" href="random-displacements.html">Random displacements</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="interfaces.html">Interfaces to calculators</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="vasp.html">VASP &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="wien2k.html">Wien2k &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="qe.html">Quantum ESPRESSO (QE) &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="abinit.html">Abinit &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="siesta.html">Siesta &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="elk.html">Elk &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="crystal.html">CRYSTAL &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="dftb%2B.html">DFTB+ &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="turbomole.html">TURBOMOLE &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="cp2k.html">CP2K &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="aims.html">FHI-aims &amp; phonopy calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="castep.html">CASTEP &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Fleur.html">Fleur &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="abacus.html">ABACUS &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="lammps.html">LAMMPS &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="vasp-dfpt.html">VASP-DFPT &amp; phonopy calculation</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="auxiliary-tools.html">Auxiliary tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="external-tools.html">External tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="phonopy-module.html">Phonopy API for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="phonopy-yaml.html">phonopy-yaml format</a></li>
<li class="toctree-l1"><a class="reference internal" href="phonopy-load.html">phonopy-load command</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Temperature dependent force constants calculation using pypolymlp and symfc</a></li>
<li class="toctree-l1"><a class="reference internal" href="formulation.html">Formulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">How to cite phonopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/mlp-sscha.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Temperature dependent force constants calculation using pypolymlp and symfc</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citation-of-pypolymlp">Citation of pypolymlp</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citation-of-symfc">Citation of symfc</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements">Requirements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-calculate">How to calculate</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#workflow">Workflow</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#steps-1-3-dataset-preparation">Steps 1-3: Dataset preparation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#steps-4-7-force-constants-calculation-systematic-displacements-in-step-5">Steps 4-7: Force constants calculation (systematic displacements in step 5)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-8-temperature-dependent-force-constants-calculation">Step 8: Temperature dependent force constants calculation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters-for-developing-mlps">Parameters for developing MLPs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ntrain-and-ntest"><code class="docutils literal notranslate"><span class="pre">ntrain</span></code> and <code class="docutils literal notranslate"><span class="pre">ntest</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#convergence-with-respect-to-dataset-size">Convergence with respect to dataset size</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="temperature-dependent-force-constants-calculation-using-pypolymlp-and-symfc">
<span id="mlp-sscha"></span><h1>Temperature dependent force constants calculation using pypolymlp and symfc<a class="headerlink" href="#temperature-dependent-force-constants-calculation-using-pypolymlp-and-symfc" title="Link to this heading">#</a></h1>
<p><strong>This is an experimental feature, and its usage may change occasionally.</strong></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This feature is supported through the <code class="docutils literal notranslate"><span class="pre">phonopy-load</span></code> command but not the <code class="docutils literal notranslate"><span class="pre">phonopy</span></code>
command.</p>
</div>
<p>With the <code class="docutils literal notranslate"><span class="pre">--pypolymlp</span></code> option, phonopy can interface with the polynomial machine
learning potential (MLP) code,
<a class="reference external" href="https://github.com/sekocha/pypolymlp">pypolymlp</a>, to perform training and
evaluation tasks of MLPs. This feature aims to reduce the computational cost of
anharmonic force constant calculations by using MLPs as an intermediary layer,
efficiently representing atomic interactions. The example is found at
<code class="docutils literal notranslate"><span class="pre">example/KCl-SSCHA</span></code>.</p>
<p>The training process involves using a dataset consisting of supercell
displacements, forces, and energies. The trained MLPs are then employed to
compute forces for supercells with specific displacements.</p>
<p>For further details on combining phonopy calculations with pypolymlp, refer to
<u>A. Togo and A. Seko, J. Chem. Phys. <strong>160</strong>, 211001 (2024)</u>
[<a class="reference external" href="https://doi.org/10.1063/5.0211296">doi</a>]
[<a class="reference external" href="https://arxiv.org/abs/2401.17531">arxiv</a>].</p>
<p>Using the polynomial MLPs, stochastic self-consistent harmonic approximation
(SSCHA) calculation is performed in the following sections. By this, temperature
dependent force constants are calculated within SSCHA. About SSCHA, please refer
the paper by <u>L. Monacelli <em>et al.</em>, J. Phys.: Condens. Matter <strong>33</strong> 363001
(2021)</u> and <u>A. van Roekeghem A, <em>et al.</em>, Comput. Phys. Commun. <strong>263</strong>
107945 (2021)</u>. Technically, the computational procedure introduced here is
equivalent to the approach of the latter paper.</p>
<section id="citation-of-pypolymlp">
<h2>Citation of pypolymlp<a class="headerlink" href="#citation-of-pypolymlp" title="Link to this heading">#</a></h2>
<p>“Tutorial: Systematic development of polynomial machine learning potentials for
elemental and alloy systems”, A. Seko, J. Appl. Phys. <strong>133</strong>, 011101 (2023)
[<a class="reference external" href="https://doi.org/10.1063/5.0129045">doi</a>].</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@article</span><span class="p">{</span><span class="n">pypolymlp</span><span class="p">,</span>
  <span class="n">author</span> <span class="o">=</span> <span class="p">{</span><span class="n">Seko</span><span class="p">,</span> <span class="n">Atsuto</span><span class="p">},</span>
  <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;{&quot;</span><span class="n">Tutorial</span><span class="p">:</span> <span class="n">Systematic</span> <span class="n">development</span> <span class="n">of</span> <span class="n">polynomial</span> <span class="n">machine</span> <span class="n">learning</span> <span class="n">potentials</span> <span class="k">for</span> <span class="n">elemental</span> <span class="ow">and</span> <span class="n">alloy</span> <span class="n">systems</span><span class="s2">&quot;}&quot;</span><span class="p">,</span>
  <span class="n">journal</span> <span class="o">=</span> <span class="p">{</span><span class="n">J</span><span class="o">.</span> <span class="n">Appl</span><span class="o">.</span> <span class="n">Phys</span><span class="o">.</span><span class="p">},</span>
  <span class="n">volume</span> <span class="o">=</span> <span class="p">{</span><span class="mi">133</span><span class="p">},</span>
  <span class="n">number</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">},</span>
  <span class="n">pages</span> <span class="o">=</span> <span class="p">{</span><span class="mi">011101</span><span class="p">},</span>
  <span class="n">year</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2023</span><span class="p">},</span>
  <span class="n">month</span> <span class="o">=</span> <span class="p">{</span><span class="mi">01</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="citation-of-symfc">
<h2>Citation of symfc<a class="headerlink" href="#citation-of-symfc" title="Link to this heading">#</a></h2>
<p>“Projector-based efficient estimation of force constants”,
A. Seko and A. Togo, Phys. Rev. B, <strong>110</strong>, 214302 (2024) [<a class="reference external" href="https://doi.org/10.1103/PhysRevB.110.214302">doi</a>]
[<a class="reference external" href="https://arxiv.org/abs/2403.03588">arxiv</a>].</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@article</span><span class="p">{</span><span class="n">PhysRevB</span><span class="mf">.110.214302</span><span class="p">,</span>
  <span class="n">title</span> <span class="o">=</span> <span class="p">{</span><span class="n">Projector</span><span class="o">-</span><span class="n">based</span> <span class="n">efficient</span> <span class="n">estimation</span> <span class="n">of</span> <span class="n">force</span> <span class="n">constants</span><span class="p">},</span>
  <span class="n">author</span> <span class="o">=</span> <span class="p">{</span><span class="n">Seko</span><span class="p">,</span> <span class="n">Atsuto</span> <span class="ow">and</span> <span class="n">Togo</span><span class="p">,</span> <span class="n">Atsushi</span><span class="p">},</span>
  <span class="n">journal</span> <span class="o">=</span> <span class="p">{</span><span class="n">Phys</span><span class="o">.</span> <span class="n">Rev</span><span class="o">.</span> <span class="n">B</span><span class="p">},</span>
  <span class="n">volume</span> <span class="o">=</span> <span class="p">{</span><span class="mi">110</span><span class="p">},</span>
  <span class="n">issue</span> <span class="o">=</span> <span class="p">{</span><span class="mi">21</span><span class="p">},</span>
  <span class="n">pages</span> <span class="o">=</span> <span class="p">{</span><span class="mi">214302</span><span class="p">},</span>
  <span class="n">numpages</span> <span class="o">=</span> <span class="p">{</span><span class="mi">18</span><span class="p">},</span>
  <span class="n">year</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2024</span><span class="p">},</span>
  <span class="n">month</span> <span class="o">=</span> <span class="p">{</span><span class="n">Dec</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Link to this heading">#</a></h2>
<ul>
<li><p><a class="reference external" href="https://github.com/sekocha/pypolymlp">pypolymlp</a> &gt;= 0.4.6</p>
<p>For linux (x86-64), a compiled package of pypolymlp can be installed via
conda-forge (recommended). Otherwise, pypolymlp can be installed from
source-code.</p>
</li>
<li><p><a class="reference external" href="https://github.com/sekocha/pypolymlp">symfc</a> &gt;= 1.1.7</p></li>
</ul>
</section>
<section id="how-to-calculate">
<h2>How to calculate<a class="headerlink" href="#how-to-calculate" title="Link to this heading">#</a></h2>
<section id="workflow">
<h3>Workflow<a class="headerlink" href="#workflow" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Generate random displacements in supercells. Use <a class="reference internal" href="setting-tags.html#random-displacements-tag"><span class="std std-ref">–rd</span></a> option.</p></li>
<li><p>Calculate corresponding forces and energies in supercells. Use of VASP
interface is recommended for <a class="reference internal" href="command-options.html#save-params-option"><span class="std std-ref">–sp</span></a> option is
supported.</p></li>
<li><p>Prepare dataset composed of displacements, forces, and energies in
supercells. The dataset must be stored in a phonopy-yaml-like file, e.g.,
<code class="docutils literal notranslate"><span class="pre">phonopy_params.yaml</span></code>. Use <a class="reference internal" href="command-options.html#f-force-sets-option"><span class="std std-ref">-f</span></a> and <a class="reference internal" href="command-options.html#save-params-option"><span class="std std-ref">–sp</span></a> option simultaneously.</p></li>
<li><p>Develop MLPs. By default, 90 and 10 percents of the dataset are used for the
training and test, respectively. At this step <code class="docutils literal notranslate"><span class="pre">phonopy.pmlp</span></code> is saved.</p></li>
<li><p>Generate displacements in supercells either systematic or random displacements.</p></li>
<li><p>Evaluate MLPs for forces of the supercells generated in step 5.</p></li>
<li><p>Calculate force constants from displacement-force dataset from steps 5 and 6.</p></li>
<li><p>Temperature dependent force constants calculation</p></li>
</ol>
<p>The steps 4-7 are executed in running phonopy with <code class="docutils literal notranslate"><span class="pre">--pypolymlp</span></code>
option.</p>
</section>
<section id="steps-1-3-dataset-preparation">
<h3>Steps 1-3: Dataset preparation<a class="headerlink" href="#steps-1-3-dataset-preparation" title="Link to this heading">#</a></h3>
<p>For the training, the following supercell data are required in the phonopy
setting to use pypolymlp:</p>
<ul class="simple">
<li><p>Displacements</p></li>
<li><p>Forces</p></li>
<li><p>Total energies</p></li>
</ul>
<p>These data must be stored in phonopy.yaml-like file.</p>
<p>The supercells with displacements are generated by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phonopy</span> <span class="o">--</span><span class="n">pa</span> <span class="n">auto</span> <span class="o">--</span><span class="n">rd</span> <span class="mi">1000</span> <span class="o">-</span><span class="n">c</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">unitcell</span> <span class="o">--</span><span class="n">dim</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="o">--</span><span class="n">amin</span> <span class="mf">0.03</span> <span class="o">--</span><span class="n">amax</span> <span class="mf">1.5</span>
        <span class="n">_</span>
  <span class="n">_</span> <span class="n">__</span> <span class="o">|</span> <span class="o">|</span><span class="n">__</span>   <span class="n">___</span>  <span class="n">_</span> <span class="n">__</span>   <span class="n">___</span>   <span class="n">_</span> <span class="n">__</span>  <span class="n">_</span>   <span class="n">_</span>
 <span class="o">|</span> <span class="s1">&#39;_ \| &#39;</span><span class="n">_</span> \ <span class="o">/</span> <span class="n">_</span> \<span class="o">|</span> <span class="s1">&#39;_ \ / _ \ | &#39;</span><span class="n">_</span> \<span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>
 <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">||</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
 <span class="o">|</span> <span class="o">.</span><span class="n">__</span><span class="o">/|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="o">/|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">.</span><span class="n">__</span><span class="o">/</span> \<span class="n">__</span><span class="p">,</span> <span class="o">|</span>
 <span class="o">|</span><span class="n">_</span><span class="o">|</span>                            <span class="o">|</span><span class="n">_</span><span class="o">|</span>    <span class="o">|</span><span class="n">___</span><span class="o">/</span>
                                      <span class="mf">2.31.1</span>

<span class="n">Compiled</span> <span class="k">with</span> <span class="n">OpenMP</span> <span class="n">support</span> <span class="p">(</span><span class="nb">max</span> <span class="mi">10</span> <span class="n">threads</span><span class="p">)</span><span class="o">.</span>
<span class="n">Python</span> <span class="n">version</span> <span class="mf">3.12.6</span>
<span class="n">Spglib</span> <span class="n">version</span> <span class="mf">2.5.0</span>

<span class="n">Crystal</span> <span class="n">structure</span> <span class="n">was</span> <span class="n">read</span> <span class="kn">from</span> <span class="s2">&quot;POSCAR-unitcell&quot;</span><span class="o">.</span>
<span class="n">Unit</span> <span class="n">of</span> <span class="n">length</span><span class="p">:</span> <span class="n">angstrom</span>
<span class="n">Displacements</span> <span class="n">creation</span> <span class="n">mode</span>
  <span class="n">Number</span> <span class="n">of</span> <span class="n">supercells</span> <span class="k">with</span> <span class="n">random</span> <span class="n">displacements</span><span class="p">:</span> <span class="mi">1000</span>
  <span class="n">Min</span> <span class="n">displacement</span> <span class="n">distance</span><span class="p">:</span> <span class="mf">0.03</span>
  <span class="n">Max</span> <span class="n">displacement</span> <span class="n">distance</span><span class="p">:</span> <span class="mf">1.5</span>
<span class="n">Settings</span><span class="p">:</span>
  <span class="n">Supercell</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span><span class="p">]</span>
  <span class="n">Primitive</span> <span class="n">matrix</span> <span class="p">(</span><span class="n">Auto</span><span class="p">):</span>
    <span class="p">[</span><span class="mf">0.</span>  <span class="mf">0.5</span> <span class="mf">0.5</span><span class="p">]</span>
    <span class="p">[</span><span class="mf">0.5</span> <span class="mf">0.</span>  <span class="mf">0.5</span><span class="p">]</span>
    <span class="p">[</span><span class="mf">0.5</span> <span class="mf">0.5</span> <span class="mf">0.</span> <span class="p">]</span>
<span class="n">Spacegroup</span><span class="p">:</span> <span class="n">Fm</span><span class="o">-</span><span class="mi">3</span><span class="n">m</span> <span class="p">(</span><span class="mi">225</span><span class="p">)</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">symmetry</span> <span class="n">operations</span> <span class="ow">in</span> <span class="n">supercell</span><span class="p">:</span> <span class="mi">1536</span>
<span class="n">Use</span> <span class="o">-</span><span class="n">v</span> <span class="n">option</span> <span class="n">to</span> <span class="n">watch</span> <span class="n">primitive</span> <span class="n">cell</span><span class="p">,</span> <span class="n">unit</span> <span class="n">cell</span><span class="p">,</span> <span class="ow">and</span> <span class="n">supercell</span> <span class="n">structures</span><span class="o">.</span>

<span class="s2">&quot;phonopy_disp.yaml&quot;</span> <span class="ow">and</span> <span class="n">supercells</span> <span class="n">have</span> <span class="n">been</span> <span class="n">created</span><span class="o">.</span>

<span class="n">Summary</span> <span class="n">of</span> <span class="n">calculation</span> <span class="n">was</span> <span class="n">written</span> <span class="ow">in</span> <span class="s2">&quot;phonopy_disp.yaml&quot;</span><span class="o">.</span>
                 <span class="n">_</span>
   <span class="n">___</span> <span class="n">_</span> <span class="n">__</span>   <span class="n">__</span><span class="o">|</span> <span class="o">|</span>
  <span class="o">/</span> <span class="n">_</span> \ <span class="s1">&#39;_ \ / _` |</span>
 <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
  \<span class="n">___</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">__</span><span class="p">,</span><span class="n">_</span><span class="o">|</span>
</pre></div>
</div>
<p>For the generated supercells, forces and energies are calculated. Here it is
assumed to use the VASP code. Once the calculations are complete, the data
(forces and energies) can be extracted using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span>phonopy<span class="w"> </span>--sp<span class="w"> </span>-f<span class="w"> </span>vasprun_xmls/vasprun-<span class="o">{</span><span class="m">001</span>..120<span class="o">}</span>.xml
</pre></div>
</div>
<p>This command extracts the necessary data and stores it in the
<code class="docutils literal notranslate"><span class="pre">phonopy_params.yaml</span></code> file. For more details, refer to the description of the
<a class="reference internal" href="command-options.html#save-params-option"><span class="std std-ref">–sp</span></a> option. Currently, supercell energy extraction
from calculator outputs is only supported when using the VASP interface.</p>
</section>
<section id="steps-4-7-force-constants-calculation-systematic-displacements-in-step-5">
<h3>Steps 4-7: Force constants calculation (systematic displacements in step 5)<a class="headerlink" href="#steps-4-7-force-constants-calculation-systematic-displacements-in-step-5" title="Link to this heading">#</a></h3>
<p>After developing MLPs, displacements are generated systematically considering
crystal symmetry.</p>
<p>Having <code class="docutils literal notranslate"><span class="pre">phonopy_params.yaml</span></code>, phonopy is executed with <code class="docutils literal notranslate"><span class="pre">--pypolymlp</span></code> option,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phonopy</span><span class="o">-</span><span class="n">load</span> <span class="n">phonopy_mlpsscha_params_KCl</span><span class="o">-</span><span class="mf">120.</span><span class="n">yaml</span><span class="o">.</span><span class="n">xz</span> <span class="o">--</span><span class="n">pypolymlp</span> <span class="o">--</span><span class="n">mlp</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="s2">&quot;ntrain=100, ntest=20&quot;</span>
        <span class="n">_</span>
  <span class="n">_</span> <span class="n">__</span> <span class="o">|</span> <span class="o">|</span><span class="n">__</span>   <span class="n">___</span>  <span class="n">_</span> <span class="n">__</span>   <span class="n">___</span>   <span class="n">_</span> <span class="n">__</span>  <span class="n">_</span>   <span class="n">_</span>
 <span class="o">|</span> <span class="s1">&#39;_ \| &#39;</span><span class="n">_</span> \ <span class="o">/</span> <span class="n">_</span> \<span class="o">|</span> <span class="s1">&#39;_ \ / _ \ | &#39;</span><span class="n">_</span> \<span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>
 <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">||</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
 <span class="o">|</span> <span class="o">.</span><span class="n">__</span><span class="o">/|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="o">/|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">.</span><span class="n">__</span><span class="o">/</span> \<span class="n">__</span><span class="p">,</span> <span class="o">|</span>
 <span class="o">|</span><span class="n">_</span><span class="o">|</span>                            <span class="o">|</span><span class="n">_</span><span class="o">|</span>    <span class="o">|</span><span class="n">___</span><span class="o">/</span>
                                      <span class="mf">2.31.2</span>

<span class="n">Compiled</span> <span class="k">with</span> <span class="n">OpenMP</span> <span class="n">support</span> <span class="p">(</span><span class="nb">max</span> <span class="mi">10</span> <span class="n">threads</span><span class="p">)</span><span class="o">.</span>
<span class="n">Running</span> <span class="ow">in</span> <span class="n">phonopy</span><span class="o">.</span><span class="n">load</span> <span class="n">mode</span><span class="o">.</span>
<span class="n">Python</span> <span class="n">version</span> <span class="mf">3.12.3</span>
<span class="n">Spglib</span> <span class="n">version</span> <span class="mf">2.5.0</span>

<span class="n">Crystal</span> <span class="n">structure</span> <span class="n">was</span> <span class="n">read</span> <span class="kn">from</span> <span class="s2">&quot;phonopy_mlpsscha_params_KCl-120.yaml.xz&quot;</span><span class="o">.</span>
<span class="n">Unit</span> <span class="n">of</span> <span class="n">length</span><span class="p">:</span> <span class="n">angstrom</span>
<span class="n">Settings</span><span class="p">:</span>
  <span class="n">Supercell</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span><span class="p">]</span>
  <span class="n">Primitive</span> <span class="n">matrix</span><span class="p">:</span>
    <span class="p">[</span><span class="mf">0.</span>  <span class="mf">0.5</span> <span class="mf">0.5</span><span class="p">]</span>
    <span class="p">[</span><span class="mf">0.5</span> <span class="mf">0.</span>  <span class="mf">0.5</span><span class="p">]</span>
    <span class="p">[</span><span class="mf">0.5</span> <span class="mf">0.5</span> <span class="mf">0.</span> <span class="p">]</span>
<span class="n">Spacegroup</span><span class="p">:</span> <span class="n">Fm</span><span class="o">-</span><span class="mi">3</span><span class="n">m</span> <span class="p">(</span><span class="mi">225</span><span class="p">)</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">symmetry</span> <span class="n">operations</span> <span class="ow">in</span> <span class="n">supercell</span><span class="p">:</span> <span class="mi">1536</span>
<span class="n">Use</span> <span class="o">-</span><span class="n">v</span> <span class="n">option</span> <span class="n">to</span> <span class="n">watch</span> <span class="n">primitive</span> <span class="n">cell</span><span class="p">,</span> <span class="n">unit</span> <span class="n">cell</span><span class="p">,</span> <span class="ow">and</span> <span class="n">supercell</span> <span class="n">structures</span><span class="o">.</span>

<span class="n">NAC</span> <span class="n">parameters</span> <span class="n">were</span> <span class="n">read</span> <span class="kn">from</span> <span class="s2">&quot;phonopy_mlpsscha_params_KCl-120.yaml.xz&quot;</span><span class="o">.</span>
<span class="n">Displacement</span><span class="o">-</span><span class="n">force</span> <span class="n">dataset</span> <span class="n">was</span> <span class="n">read</span> <span class="kn">from</span> <span class="s2">&quot;phonopy_mlpsscha_params_KCl-120.yaml.xz&quot;</span><span class="o">.</span>
<span class="o">-----------------------------</span> <span class="n">pypolymlp</span> <span class="n">start</span> <span class="o">------------------------------</span>
<span class="n">Pypolymlp</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">generator</span> <span class="n">of</span> <span class="n">polynomial</span> <span class="n">machine</span> <span class="n">learning</span> <span class="n">potentials</span><span class="o">.</span>
<span class="n">Please</span> <span class="n">cite</span> <span class="n">the</span> <span class="n">paper</span><span class="p">:</span> <span class="n">A</span><span class="o">.</span> <span class="n">Seko</span><span class="p">,</span> <span class="n">J</span><span class="o">.</span> <span class="n">Appl</span><span class="o">.</span> <span class="n">Phys</span><span class="o">.</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">011101</span> <span class="p">(</span><span class="mi">2023</span><span class="p">)</span><span class="o">.</span>
<span class="n">Pypolymlp</span> <span class="ow">is</span> <span class="n">developed</span> <span class="n">at</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">sekocha</span><span class="o">/</span><span class="n">pypolymlp</span><span class="o">.</span>
<span class="n">Parameters</span><span class="p">:</span>
  <span class="n">cutoff</span><span class="p">:</span> <span class="mf">8.0</span>
  <span class="n">model_type</span><span class="p">:</span> <span class="mi">3</span>
  <span class="n">max_p</span><span class="p">:</span> <span class="mi">2</span>
  <span class="n">gtinv_order</span><span class="p">:</span> <span class="mi">3</span>
  <span class="n">gtinv_maxl</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
  <span class="n">gaussian_params1</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="n">gaussian_params2</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
  <span class="n">ntrain</span><span class="p">:</span> <span class="mi">100</span>
  <span class="n">ntest</span><span class="p">:</span> <span class="mi">20</span>
<span class="n">Developing</span> <span class="n">MLPs</span> <span class="n">by</span> <span class="n">pypolymlp</span><span class="o">...</span>
<span class="n">Regression</span><span class="p">:</span> <span class="n">cholesky</span> <span class="n">decomposition</span> <span class="o">...</span>
<span class="o">-</span> <span class="n">alpha</span><span class="p">:</span> <span class="mf">0.001</span>
<span class="o">-</span> <span class="n">alpha</span><span class="p">:</span> <span class="mf">0.01</span>
<span class="o">-</span> <span class="n">alpha</span><span class="p">:</span> <span class="mf">0.1</span>
<span class="o">-</span> <span class="n">alpha</span><span class="p">:</span> <span class="mf">1.0</span>
<span class="o">-</span> <span class="n">alpha</span><span class="p">:</span> <span class="mf">10.0</span>
<span class="n">Clear</span> <span class="n">training</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">X</span>
<span class="n">Calculate</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">X</span> <span class="k">for</span> <span class="n">test</span> <span class="n">data</span>
<span class="n">Clear</span> <span class="n">test</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">X</span>
<span class="n">Regression</span><span class="p">:</span> <span class="n">model</span> <span class="n">selection</span> <span class="o">...</span>
<span class="o">-</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.000e-03</span> <span class="p">:</span> <span class="n">rmse</span> <span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.02432</span> <span class="mf">0.23669</span>
<span class="o">-</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.000e-02</span> <span class="p">:</span> <span class="n">rmse</span> <span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.03613</span> <span class="mf">0.16766</span>
<span class="o">-</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.000e-01</span> <span class="p">:</span> <span class="n">rmse</span> <span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.07193</span> <span class="mf">0.22140</span>
<span class="o">-</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.000e+00</span> <span class="p">:</span> <span class="n">rmse</span> <span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.11563</span> <span class="mf">0.26042</span>
<span class="o">-</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.000e+01</span> <span class="p">:</span> <span class="n">rmse</span> <span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.19375</span> <span class="mf">0.31767</span>
<span class="n">MLPs</span> <span class="n">were</span> <span class="n">written</span> <span class="n">into</span> <span class="s2">&quot;phonopy.pmlp&quot;</span>
<span class="o">------------------------------</span> <span class="n">pypolymlp</span> <span class="n">end</span> <span class="o">-------------------------------</span>
<span class="n">Generate</span> <span class="n">displacements</span>
  <span class="n">Displacement</span> <span class="n">distance</span><span class="p">:</span> <span class="mf">0.001</span>
<span class="n">Evaluate</span> <span class="n">forces</span> <span class="ow">in</span> <span class="mi">4</span> <span class="n">supercells</span> <span class="n">by</span> <span class="n">pypolymlp</span>
<span class="o">--------------------------------</span> <span class="n">Symfc</span> <span class="n">start</span> <span class="o">-------------------------------</span>
<span class="n">Symfc</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">force</span> <span class="n">constants</span> <span class="n">calculator</span><span class="o">.</span> <span class="n">See</span> <span class="n">the</span> <span class="n">following</span> <span class="n">paper</span><span class="p">:</span>
<span class="n">A</span><span class="o">.</span> <span class="n">Seko</span> <span class="ow">and</span> <span class="n">A</span><span class="o">.</span> <span class="n">Togo</span><span class="p">,</span> <span class="n">arXiv</span><span class="p">:</span><span class="mf">2403.03588</span><span class="o">.</span>
<span class="n">Symfc</span> <span class="ow">is</span> <span class="n">developed</span> <span class="n">at</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">symfc</span><span class="o">/</span><span class="n">symfc</span><span class="o">.</span>
<span class="n">Computing</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">order</span> <span class="n">force</span> <span class="n">constants</span><span class="o">.</span>
<span class="n">Increase</span> <span class="n">log</span><span class="o">-</span><span class="n">level</span> <span class="n">to</span> <span class="n">watch</span> <span class="n">detailed</span> <span class="n">symfc</span> <span class="n">log</span><span class="o">.</span>
<span class="o">---------------------------------</span> <span class="n">Symfc</span> <span class="n">end</span> <span class="o">--------------------------------</span>
<span class="n">Max</span> <span class="n">drift</span> <span class="n">of</span> <span class="n">force</span> <span class="n">constants</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.000000</span> <span class="p">(</span><span class="n">yy</span><span class="p">)</span> <span class="o">-</span><span class="mf">0.000000</span> <span class="p">(</span><span class="n">yy</span><span class="p">)</span>

<span class="o">----------------------------------------------------------------------------</span>
 <span class="n">One</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">run</span> <span class="n">modes</span> <span class="n">may</span> <span class="n">be</span> <span class="n">specified</span> <span class="k">for</span> <span class="n">phonon</span> <span class="n">calculations</span><span class="o">.</span>
 <span class="o">-</span> <span class="n">Mesh</span> <span class="n">sampling</span> <span class="p">(</span><span class="n">MESH</span><span class="p">,</span> <span class="o">--</span><span class="n">mesh</span><span class="p">)</span>
 <span class="o">-</span> <span class="n">Q</span><span class="o">-</span><span class="n">points</span> <span class="p">(</span><span class="n">QPOINTS</span><span class="p">,</span> <span class="o">--</span><span class="n">qpoints</span><span class="p">)</span>
 <span class="o">-</span> <span class="n">Band</span> <span class="n">structure</span> <span class="p">(</span><span class="n">BAND</span><span class="p">,</span> <span class="o">--</span><span class="n">band</span><span class="p">)</span>
 <span class="o">-</span> <span class="n">Animation</span> <span class="p">(</span><span class="n">ANIME</span><span class="p">,</span> <span class="o">--</span><span class="n">anime</span><span class="p">)</span>
 <span class="o">-</span> <span class="n">Modulation</span> <span class="p">(</span><span class="n">MODULATION</span><span class="p">,</span> <span class="o">--</span><span class="n">modulation</span><span class="p">)</span>
 <span class="o">-</span> <span class="n">Characters</span> <span class="n">of</span> <span class="n">Irreps</span> <span class="p">(</span><span class="n">IRREPS</span><span class="p">,</span> <span class="o">--</span><span class="n">irreps</span><span class="p">)</span>
 <span class="o">-</span> <span class="n">Create</span> <span class="n">displacements</span> <span class="p">(</span><span class="n">CREATE_DISPLACEMENTS</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">)</span>
<span class="o">----------------------------------------------------------------------------</span>
<span class="n">Dataset</span> <span class="n">generated</span> <span class="n">using</span> <span class="n">MMLPs</span> <span class="n">was</span> <span class="n">written</span> <span class="ow">in</span> <span class="s2">&quot;phonopy_mlp_eval_dataset.yaml&quot;</span><span class="o">.</span>

<span class="n">Summary</span> <span class="n">of</span> <span class="n">calculation</span> <span class="n">was</span> <span class="n">written</span> <span class="ow">in</span> <span class="s2">&quot;phonopy.yaml&quot;</span><span class="o">.</span>
                 <span class="n">_</span>
   <span class="n">___</span> <span class="n">_</span> <span class="n">__</span>   <span class="n">__</span><span class="o">|</span> <span class="o">|</span>
  <span class="o">/</span> <span class="n">_</span> \ <span class="s1">&#39;_ \ / _` |</span>
 <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
  \<span class="n">___</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">__</span><span class="p">,</span><span class="n">_</span><span class="o">|</span>
</pre></div>
</div>
<p>Information about the development of MLPs using pypolymlp is provided between
the <code class="docutils literal notranslate"><span class="pre">pypolymlp</span> <span class="pre">start</span></code> and <code class="docutils literal notranslate"><span class="pre">pypolymlp</span> <span class="pre">end</span></code> sections. The polynomial MLPs are
saved in the <code class="docutils literal notranslate"><span class="pre">phonopy.pmlp</span></code> file. This file is automatically searched in
subsequent phonopy executions with the <code class="docutils literal notranslate"><span class="pre">--pypolymlp</span></code> option and reused.</p>
<p>After the MLPs are developed, systematic displacements, such as those involving
the displacement of one or two atoms in supercells, are generated with a
displacement distance of 0.001 Angstrom. The forces for these supercells are
then evaluated using pypolymlp. Both the generated displacements and the
corresponding forces are stored in the <code class="docutils literal notranslate"><span class="pre">phonopy_mlp_eval_dataset</span></code> file.
The calculated force constants may be refered as the harmonic force constants.</p>
<section id="step-8-temperature-dependent-force-constants-calculation">
<h4>Step 8: Temperature dependent force constants calculation<a class="headerlink" href="#step-8-temperature-dependent-force-constants-calculation" title="Link to this heading">#</a></h4>
<p>After the last step, the <code class="docutils literal notranslate"><span class="pre">phonopy.pmlp</span></code> file exists in the current directory.
This file is read automatically in the next calculation with the <code class="docutils literal notranslate"><span class="pre">--pypolymlp</span></code>
option. If the developed MLPs can predict well forces at relatively large
displacements, temperature dependent force constants are calculated with the
<code class="docutils literal notranslate"><span class="pre">--sscha</span> <span class="pre">NUMBER_OF_ITERATIONS</span></code> option.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phonopy</span><span class="o">-</span><span class="n">load</span> <span class="n">phonopy_mlpsscha_params_KCl</span><span class="o">-</span><span class="mf">120.</span><span class="n">yaml</span><span class="o">.</span><span class="n">xz</span> <span class="o">--</span><span class="n">pypolymlp</span> <span class="o">--</span><span class="n">sscha</span> <span class="mi">10</span> <span class="o">--</span><span class="n">rd</span><span class="o">-</span><span class="n">temperature</span> <span class="mi">300</span> <span class="o">--</span><span class="n">rd</span> <span class="mi">1000</span>
        <span class="n">_</span>
  <span class="n">_</span> <span class="n">__</span> <span class="o">|</span> <span class="o">|</span><span class="n">__</span>   <span class="n">___</span>  <span class="n">_</span> <span class="n">__</span>   <span class="n">___</span>   <span class="n">_</span> <span class="n">__</span>  <span class="n">_</span>   <span class="n">_</span>
 <span class="o">|</span> <span class="s1">&#39;_ \| &#39;</span><span class="n">_</span> \ <span class="o">/</span> <span class="n">_</span> \<span class="o">|</span> <span class="s1">&#39;_ \ / _ \ | &#39;</span><span class="n">_</span> \<span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>
 <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">||</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
 <span class="o">|</span> <span class="o">.</span><span class="n">__</span><span class="o">/|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="o">/|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">.</span><span class="n">__</span><span class="o">/</span> \<span class="n">__</span><span class="p">,</span> <span class="o">|</span>
 <span class="o">|</span><span class="n">_</span><span class="o">|</span>                            <span class="o">|</span><span class="n">_</span><span class="o">|</span>    <span class="o">|</span><span class="n">___</span><span class="o">/</span>
                                      <span class="mf">2.31.2</span>

<span class="n">Compiled</span> <span class="k">with</span> <span class="n">OpenMP</span> <span class="n">support</span> <span class="p">(</span><span class="nb">max</span> <span class="mi">10</span> <span class="n">threads</span><span class="p">)</span><span class="o">.</span>
<span class="n">Running</span> <span class="ow">in</span> <span class="n">phonopy</span><span class="o">.</span><span class="n">load</span> <span class="n">mode</span><span class="o">.</span>
<span class="n">Python</span> <span class="n">version</span> <span class="mf">3.12.3</span>
<span class="n">Spglib</span> <span class="n">version</span> <span class="mf">2.5.0</span>

<span class="n">Crystal</span> <span class="n">structure</span> <span class="n">was</span> <span class="n">read</span> <span class="kn">from</span> <span class="s2">&quot;phonopy_mlpsscha_params_KCl-120.yaml.xz&quot;</span><span class="o">.</span>
<span class="n">Unit</span> <span class="n">of</span> <span class="n">length</span><span class="p">:</span> <span class="n">angstrom</span>
<span class="n">Displacements</span> <span class="n">creation</span> <span class="n">mode</span>
  <span class="n">Number</span> <span class="n">of</span> <span class="n">supercells</span> <span class="k">with</span> <span class="n">random</span> <span class="n">displacements</span><span class="p">:</span> <span class="mi">1000</span>
  <span class="n">Temperatuere</span> <span class="n">to</span> <span class="n">generate</span> <span class="n">random</span> <span class="n">displacements</span><span class="p">:</span> <span class="mf">300.0</span>
<span class="n">Settings</span><span class="p">:</span>
  <span class="n">Supercell</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span><span class="p">]</span>
  <span class="n">Primitive</span> <span class="n">matrix</span><span class="p">:</span>
    <span class="p">[</span><span class="mf">0.</span>  <span class="mf">0.5</span> <span class="mf">0.5</span><span class="p">]</span>
    <span class="p">[</span><span class="mf">0.5</span> <span class="mf">0.</span>  <span class="mf">0.5</span><span class="p">]</span>
    <span class="p">[</span><span class="mf">0.5</span> <span class="mf">0.5</span> <span class="mf">0.</span> <span class="p">]</span>
<span class="n">Spacegroup</span><span class="p">:</span> <span class="n">Fm</span><span class="o">-</span><span class="mi">3</span><span class="n">m</span> <span class="p">(</span><span class="mi">225</span><span class="p">)</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">symmetry</span> <span class="n">operations</span> <span class="ow">in</span> <span class="n">supercell</span><span class="p">:</span> <span class="mi">1536</span>
<span class="n">Use</span> <span class="o">-</span><span class="n">v</span> <span class="n">option</span> <span class="n">to</span> <span class="n">watch</span> <span class="n">primitive</span> <span class="n">cell</span><span class="p">,</span> <span class="n">unit</span> <span class="n">cell</span><span class="p">,</span> <span class="ow">and</span> <span class="n">supercell</span> <span class="n">structures</span><span class="o">.</span>

<span class="n">NAC</span> <span class="n">parameters</span> <span class="n">were</span> <span class="n">read</span> <span class="kn">from</span> <span class="s2">&quot;phonopy_mlpsscha_params_KCl-120.yaml.xz&quot;</span><span class="o">.</span>
<span class="n">Displacement</span><span class="o">-</span><span class="n">force</span> <span class="n">dataset</span> <span class="n">was</span> <span class="n">read</span> <span class="kn">from</span> <span class="s2">&quot;phonopy_mlpsscha_params_KCl-120.yaml.xz&quot;</span><span class="o">.</span>
<span class="o">-----------------------------</span> <span class="n">pypolymlp</span> <span class="n">start</span> <span class="o">------------------------------</span>
<span class="n">Pypolymlp</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">generator</span> <span class="n">of</span> <span class="n">polynomial</span> <span class="n">machine</span> <span class="n">learning</span> <span class="n">potentials</span><span class="o">.</span>
<span class="n">Please</span> <span class="n">cite</span> <span class="n">the</span> <span class="n">paper</span><span class="p">:</span> <span class="n">A</span><span class="o">.</span> <span class="n">Seko</span><span class="p">,</span> <span class="n">J</span><span class="o">.</span> <span class="n">Appl</span><span class="o">.</span> <span class="n">Phys</span><span class="o">.</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">011101</span> <span class="p">(</span><span class="mi">2023</span><span class="p">)</span><span class="o">.</span>
<span class="n">Pypolymlp</span> <span class="ow">is</span> <span class="n">developed</span> <span class="n">at</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">sekocha</span><span class="o">/</span><span class="n">pypolymlp</span><span class="o">.</span>
<span class="n">Load</span> <span class="n">MLPs</span> <span class="kn">from</span> <span class="s2">&quot;phonopy.pmlp&quot;</span><span class="o">.</span>
<span class="o">------------------------------</span> <span class="n">pypolymlp</span> <span class="n">end</span> <span class="o">-------------------------------</span>
<span class="o">-------------------------------</span> <span class="n">SSCHA</span> <span class="n">start</span> <span class="o">--------------------------------</span>
<span class="p">[</span> <span class="n">SSCHA</span> <span class="n">initialization</span> <span class="p">(</span><span class="n">rd</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">n_supercells</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span> <span class="p">]</span>
<span class="n">Evaluate</span> <span class="n">MLP</span> <span class="n">to</span> <span class="n">obtain</span> <span class="n">forces</span> <span class="n">using</span> <span class="n">pypolymlp</span>
<span class="n">Calculate</span> <span class="n">force</span> <span class="n">constants</span> <span class="n">using</span> <span class="n">symfc</span>
<span class="n">SSCHA</span> <span class="n">free</span> <span class="n">energy</span><span class="p">:</span> <span class="o">-</span><span class="mf">102.786</span> <span class="n">meV</span>
<span class="n">Initial</span> <span class="n">force</span> <span class="n">constants</span> <span class="n">are</span> <span class="n">written</span> <span class="n">into</span> <span class="s2">&quot;phonopy_sscha_fc_0.yaml.xz&quot;</span><span class="o">.</span>

<span class="p">[</span> <span class="n">SSCHA</span> <span class="n">iteration</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">10</span> <span class="p">]</span>
<span class="n">Generate</span> <span class="mi">1000</span> <span class="n">supercells</span> <span class="k">with</span> <span class="n">displacements</span> <span class="n">at</span> <span class="mf">300.0</span> <span class="n">K</span>
  <span class="p">[</span><span class="mf">0.010</span><span class="p">,</span> <span class="mf">0.084</span><span class="p">]</span> <span class="o">****</span>
  <span class="p">[</span><span class="mf">0.084</span><span class="p">,</span> <span class="mf">0.159</span><span class="p">]</span> <span class="o">******************</span>
  <span class="p">[</span><span class="mf">0.159</span><span class="p">,</span> <span class="mf">0.234</span><span class="p">]</span> <span class="o">***************************</span>
  <span class="p">[</span><span class="mf">0.234</span><span class="p">,</span> <span class="mf">0.309</span><span class="p">]</span> <span class="o">*************************</span>
  <span class="p">[</span><span class="mf">0.309</span><span class="p">,</span> <span class="mf">0.383</span><span class="p">]</span> <span class="o">****************</span>
  <span class="p">[</span><span class="mf">0.383</span><span class="p">,</span> <span class="mf">0.458</span><span class="p">]</span> <span class="o">*******</span>
  <span class="p">[</span><span class="mf">0.458</span><span class="p">,</span> <span class="mf">0.533</span><span class="p">]</span> <span class="o">**</span>
  <span class="p">[</span><span class="mf">0.533</span><span class="p">,</span> <span class="mf">0.608</span><span class="p">]</span> <span class="o">*</span>
  <span class="p">[</span><span class="mf">0.608</span><span class="p">,</span> <span class="mf">0.683</span><span class="p">]</span>
  <span class="p">[</span><span class="mf">0.683</span><span class="p">,</span> <span class="mf">0.757</span><span class="p">]</span>
<span class="n">Evaluate</span> <span class="n">MLP</span> <span class="n">to</span> <span class="n">obtain</span> <span class="n">forces</span> <span class="n">using</span> <span class="n">pypolymlp</span>
<span class="n">Calculate</span> <span class="n">force</span> <span class="n">constants</span> <span class="n">using</span> <span class="n">symfc</span>
<span class="n">SSCHA</span> <span class="n">free</span> <span class="n">energy</span><span class="p">:</span> <span class="o">-</span><span class="mf">98.205</span> <span class="n">meV</span>
<span class="n">SSCHA</span> <span class="n">force</span> <span class="n">constants</span> <span class="n">are</span> <span class="n">written</span> <span class="n">into</span> <span class="s2">&quot;phonopy_sscha_fc_1.yaml.xz&quot;</span><span class="o">.</span>

<span class="p">[</span> <span class="n">SSCHA</span> <span class="n">iteration</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">10</span> <span class="p">]</span>
<span class="n">Generate</span> <span class="mi">1000</span> <span class="n">supercells</span> <span class="k">with</span> <span class="n">displacements</span> <span class="n">at</span> <span class="mf">300.0</span> <span class="n">K</span>
  <span class="p">[</span><span class="mf">0.007</span><span class="p">,</span> <span class="mf">0.094</span><span class="p">]</span> <span class="o">*****</span>
  <span class="p">[</span><span class="mf">0.094</span><span class="p">,</span> <span class="mf">0.181</span><span class="p">]</span> <span class="o">***********************</span>
  <span class="p">[</span><span class="mf">0.181</span><span class="p">,</span> <span class="mf">0.267</span><span class="p">]</span> <span class="o">********************************</span>
  <span class="p">[</span><span class="mf">0.267</span><span class="p">,</span> <span class="mf">0.354</span><span class="p">]</span> <span class="o">************************</span>
  <span class="p">[</span><span class="mf">0.354</span><span class="p">,</span> <span class="mf">0.440</span><span class="p">]</span> <span class="o">***********</span>
  <span class="p">[</span><span class="mf">0.440</span><span class="p">,</span> <span class="mf">0.527</span><span class="p">]</span> <span class="o">***</span>
  <span class="p">[</span><span class="mf">0.527</span><span class="p">,</span> <span class="mf">0.613</span><span class="p">]</span> <span class="o">*</span>
  <span class="p">[</span><span class="mf">0.613</span><span class="p">,</span> <span class="mf">0.700</span><span class="p">]</span>
  <span class="p">[</span><span class="mf">0.700</span><span class="p">,</span> <span class="mf">0.787</span><span class="p">]</span>
  <span class="p">[</span><span class="mf">0.787</span><span class="p">,</span> <span class="mf">0.873</span><span class="p">]</span>
<span class="n">Evaluate</span> <span class="n">MLP</span> <span class="n">to</span> <span class="n">obtain</span> <span class="n">forces</span> <span class="n">using</span> <span class="n">pypolymlp</span>
<span class="n">Calculate</span> <span class="n">force</span> <span class="n">constants</span> <span class="n">using</span> <span class="n">symfc</span>
<span class="n">SSCHA</span> <span class="n">free</span> <span class="n">energy</span><span class="p">:</span> <span class="o">-</span><span class="mf">98.221</span> <span class="n">meV</span>
<span class="n">SSCHA</span> <span class="n">force</span> <span class="n">constants</span> <span class="n">are</span> <span class="n">written</span> <span class="n">into</span> <span class="s2">&quot;phonopy_sscha_fc_2.yaml.xz&quot;</span><span class="o">.</span>

<span class="o">...</span>

<span class="p">[</span> <span class="n">SSCHA</span> <span class="n">iteration</span> <span class="mi">10</span> <span class="o">/</span> <span class="mi">10</span> <span class="p">]</span>
<span class="n">Generate</span> <span class="mi">1000</span> <span class="n">supercells</span> <span class="k">with</span> <span class="n">displacements</span> <span class="n">at</span> <span class="mf">300.0</span> <span class="n">K</span>
  <span class="p">[</span><span class="mf">0.006</span><span class="p">,</span> <span class="mf">0.089</span><span class="p">]</span> <span class="o">*****</span>
  <span class="p">[</span><span class="mf">0.089</span><span class="p">,</span> <span class="mf">0.171</span><span class="p">]</span> <span class="o">*********************</span>
  <span class="p">[</span><span class="mf">0.171</span><span class="p">,</span> <span class="mf">0.253</span><span class="p">]</span> <span class="o">*******************************</span>
  <span class="p">[</span><span class="mf">0.253</span><span class="p">,</span> <span class="mf">0.336</span><span class="p">]</span> <span class="o">*************************</span>
  <span class="p">[</span><span class="mf">0.336</span><span class="p">,</span> <span class="mf">0.418</span><span class="p">]</span> <span class="o">*************</span>
  <span class="p">[</span><span class="mf">0.418</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">]</span> <span class="o">****</span>
  <span class="p">[</span><span class="mf">0.500</span><span class="p">,</span> <span class="mf">0.583</span><span class="p">]</span> <span class="o">*</span>
  <span class="p">[</span><span class="mf">0.583</span><span class="p">,</span> <span class="mf">0.665</span><span class="p">]</span>
  <span class="p">[</span><span class="mf">0.665</span><span class="p">,</span> <span class="mf">0.747</span><span class="p">]</span>
  <span class="p">[</span><span class="mf">0.747</span><span class="p">,</span> <span class="mf">0.830</span><span class="p">]</span>
<span class="n">Evaluate</span> <span class="n">MLP</span> <span class="n">to</span> <span class="n">obtain</span> <span class="n">forces</span> <span class="n">using</span> <span class="n">pypolymlp</span>
<span class="n">Calculate</span> <span class="n">force</span> <span class="n">constants</span> <span class="n">using</span> <span class="n">symfc</span>
<span class="n">SSCHA</span> <span class="n">free</span> <span class="n">energy</span><span class="p">:</span> <span class="o">-</span><span class="mf">98.122</span> <span class="n">meV</span>
<span class="n">SSCHA</span> <span class="n">force</span> <span class="n">constants</span> <span class="n">are</span> <span class="n">written</span> <span class="n">into</span> <span class="s2">&quot;phonopy_sscha_fc_10.yaml.xz&quot;</span><span class="o">.</span>

<span class="o">--------------------------------</span> <span class="n">SSCHA</span> <span class="n">end</span> <span class="o">---------------------------------</span>

<span class="o">----------------------------------------------------------------------------</span>
 <span class="n">One</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">run</span> <span class="n">modes</span> <span class="n">may</span> <span class="n">be</span> <span class="n">specified</span> <span class="k">for</span> <span class="n">phonon</span> <span class="n">calculations</span><span class="o">.</span>
 <span class="o">-</span> <span class="n">Mesh</span> <span class="n">sampling</span> <span class="p">(</span><span class="n">MESH</span><span class="p">,</span> <span class="o">--</span><span class="n">mesh</span><span class="p">)</span>
 <span class="o">-</span> <span class="n">Q</span><span class="o">-</span><span class="n">points</span> <span class="p">(</span><span class="n">QPOINTS</span><span class="p">,</span> <span class="o">--</span><span class="n">qpoints</span><span class="p">)</span>
 <span class="o">-</span> <span class="n">Band</span> <span class="n">structure</span> <span class="p">(</span><span class="n">BAND</span><span class="p">,</span> <span class="o">--</span><span class="n">band</span><span class="p">)</span>
 <span class="o">-</span> <span class="n">Animation</span> <span class="p">(</span><span class="n">ANIME</span><span class="p">,</span> <span class="o">--</span><span class="n">anime</span><span class="p">)</span>
 <span class="o">-</span> <span class="n">Modulation</span> <span class="p">(</span><span class="n">MODULATION</span><span class="p">,</span> <span class="o">--</span><span class="n">modulation</span><span class="p">)</span>
 <span class="o">-</span> <span class="n">Characters</span> <span class="n">of</span> <span class="n">Irreps</span> <span class="p">(</span><span class="n">IRREPS</span><span class="p">,</span> <span class="o">--</span><span class="n">irreps</span><span class="p">)</span>
 <span class="o">-</span> <span class="n">Create</span> <span class="n">displacements</span> <span class="p">(</span><span class="n">CREATE_DISPLACEMENTS</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">)</span>
<span class="o">----------------------------------------------------------------------------</span>

<span class="n">Summary</span> <span class="n">of</span> <span class="n">calculation</span> <span class="n">was</span> <span class="n">written</span> <span class="ow">in</span> <span class="s2">&quot;phonopy.yaml&quot;</span><span class="o">.</span>
                 <span class="n">_</span>
   <span class="n">___</span> <span class="n">_</span> <span class="n">__</span>   <span class="n">__</span><span class="o">|</span> <span class="o">|</span>
  <span class="o">/</span> <span class="n">_</span> \ <span class="s1">&#39;_ \ / _` |</span>
 <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
  \<span class="n">___</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">__</span><span class="p">,</span><span class="n">_</span><span class="o">|</span>
</pre></div>
</div>
<p>The final force constants are stored in files named
<code class="docutils literal notranslate"><span class="pre">phonopy_sscha_fc_NUM.yaml.xz</span></code>, where <code class="docutils literal notranslate"><span class="pre">NUM</span></code> represents the integer corresponding
to the iteration step. By performing a sufficient number of SSCHA iterations and
utilizing a sufficiently large set of supercells with random displacements at a
given temperature, the SSCHA force constants can be reliably determined. The
convergence of these force constants can be monitored through the SSCHA free
energy. Additionally, convergence can be assessed by plotting the phonon band
structures corresponding to the SSCHA force constants at the iteration
steps. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>% for i in {0..10}; do phonopy-load phonopy_sscha_fc_$i.yaml.xz --band auto --band-points 101; mv band.yaml band-$i.yaml; done
% phonopy-bandplot band-{0..10}.yaml --legend
</pre></div>
</div>
</section>
</section>
</section>
<section id="parameters-for-developing-mlps">
<h2>Parameters for developing MLPs<a class="headerlink" href="#parameters-for-developing-mlps" title="Link to this heading">#</a></h2>
<p>A few parameters can be specified using the <code class="docutils literal notranslate"><span class="pre">--mlp-params</span></code> option for the
development of MLPs. The parameters are provided as a string, e.g.,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span>phonopy-load<span class="w"> </span>phonopy_params.yaml<span class="w"> </span>--pypolymlp<span class="w"> </span>--mlp-params<span class="o">=</span><span class="s2">&quot;ntrain=80, ntest=20&quot;</span>
</pre></div>
</div>
<p>Parameters are separated by commas for configuration. A brief explanation of the
available parameters can be found in the docstring of <code class="docutils literal notranslate"><span class="pre">PypolymlpParams</span></code> that is
found by</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">phonopy.interface.pypolymlp</span> <span class="kn">import</span> <span class="n">PypolymlpParams</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">help</span><span class="p">(</span><span class="n">PypolymlpParams</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ntrain</span></code> and <code class="docutils literal notranslate"><span class="pre">ntest</span></code> are implemented in phonopy, while the remaining parameters
are directly passed to pypolymlp. Optimizing pypolymlp parameters can be
difficult, both in terms of achieving accuracy and managing the computational
resources required. The current default parameters are likely suitable for
systems up to ternary compounds. For binary systems, the calculations can
generally be run on standard laptop computers, but for ternary systems, around
40 GB of memory or more may be necessary.</p>
<p>For parameter adjustments, it is recommended to consult the
<a class="reference external" href="https://github.com/sekocha/pypolymlp">pypolymlp</a> documentation and review the
relevant research papers.</p>
<section id="ntrain-and-ntest">
<h3><code class="docutils literal notranslate"><span class="pre">ntrain</span></code> and <code class="docutils literal notranslate"><span class="pre">ntest</span></code><a class="headerlink" href="#ntrain-and-ntest" title="Link to this heading">#</a></h3>
<p>This method provides a straightforward dataset split: the first <code class="docutils literal notranslate"><span class="pre">ntrain</span></code>
supercells from the list are used for training, while the last <code class="docutils literal notranslate"><span class="pre">ntest</span></code>
supercells are reserved for testing.</p>
</section>
</section>
<section id="convergence-with-respect-to-dataset-size">
<h2>Convergence with respect to dataset size<a class="headerlink" href="#convergence-with-respect-to-dataset-size" title="Link to this heading">#</a></h2>
<p>In general, increasing the amount of data improves the accuracy of representing
force constants. Therefore, it is recommended to check the convergence of the
target property with respect to the number of supercells in the training
dataset. Lattice thermal conductivity may be a convenient property to monitor
when assessing convergence.</p>
<p>For example, by preparing an initial set with 100 supercell data, calculations
can then be performed by varying the size of the training dataset while keeping
the test dataset unchanged as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span>phonopy-load<span class="w"> </span>--pypolymlp<span class="w"> </span>--mlp-params<span class="o">=</span><span class="s2">&quot;ntrain=20, ntest=20&quot;</span><span class="w"> </span>--br<span class="w"> </span>--mesh<span class="w"> </span><span class="m">40</span><span class="w"> </span>phonopy_params.yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>log-20
%<span class="w"> </span>phonopy-load<span class="w"> </span>--pypolymlp<span class="w"> </span>--mlp-params<span class="o">=</span><span class="s2">&quot;ntrain=40, ntest=20&quot;</span><span class="w"> </span>--br<span class="w"> </span>--mesh<span class="w"> </span><span class="m">40</span><span class="w"> </span>phonopy_params.yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>log-40
%<span class="w"> </span>phonopy-load<span class="w"> </span>--pypolymlp<span class="w"> </span>--mlp-params<span class="o">=</span><span class="s2">&quot;ntrain=60, ntest=20&quot;</span><span class="w"> </span>--br<span class="w"> </span>--mesh<span class="w"> </span><span class="m">40</span><span class="w"> </span>phonopy_params.yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>log-60
%<span class="w"> </span>phonopy-load<span class="w"> </span>--pypolymlp<span class="w"> </span>--mlp-params<span class="o">=</span><span class="s2">&quot;ntrain=80, ntest=20&quot;</span><span class="w"> </span>--br<span class="w"> </span>--mesh<span class="w"> </span><span class="m">40</span><span class="w"> </span>phonopy_params.yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>log-80
%<span class="w"> </span>phonopy-load<span class="w"> </span>--pypolymlp<span class="w"> </span>--mlp-params<span class="o">=</span><span class="s2">&quot;ntrain=100, ntest=20&quot;</span><span class="w"> </span>--br<span class="w"> </span>--mesh<span class="w"> </span><span class="m">40</span><span class="w"> </span>phonopy_params.yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>log-100
</pre></div>
</div>
<p>The computed phonon band structures are plotted against the size of the training
dataset to observe the frequency convergence. If it has not converged, an
additional set of supercell data (e.g., forces and energies in the next 100
supercells) will be computed and included. With this procedure in mind, it may
be convenient to generate a sufficiently large number of supercells with random
displacements in advance, such as 1000 supercells, before starting the
temperature dependent force constants calculation with pypolymlp.</p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="phonopy-load.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">phonopy-load command</p>
      </div>
    </a>
    <a class="right-next"
       href="formulation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Formulations</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citation-of-pypolymlp">Citation of pypolymlp</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citation-of-symfc">Citation of symfc</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements">Requirements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-calculate">How to calculate</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#workflow">Workflow</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#steps-1-3-dataset-preparation">Steps 1-3: Dataset preparation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#steps-4-7-force-constants-calculation-systematic-displacements-in-step-5">Steps 4-7: Force constants calculation (systematic displacements in step 5)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-8-temperature-dependent-force-constants-calculation">Step 8: Temperature dependent force constants calculation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters-for-developing-mlps">Parameters for developing MLPs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ntrain-and-ntest"><code class="docutils literal notranslate"><span class="pre">ntrain</span></code> and <code class="docutils literal notranslate"><span class="pre">ntest</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#convergence-with-respect-to-dataset-size">Convergence with respect to dataset size</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Author name not set
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2009, Atsushi Togo.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>