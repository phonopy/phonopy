
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>LAMMPS &amp; phonopy calculation &#8212; Phonopy v.2.24.3</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="_static/documentation_options.js?v=70f6305e"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lammps';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="VASP-DFPT &amp; phonopy calculation" href="vasp-dfpt.html" />
    <link rel="prev" title="ABACUS &amp; phonopy calculation" href="abacus.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">Phonopy v.2.24.3</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="symmetry.html">Crystal symmetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Work flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="input-files.html">Input files</a></li>
<li class="toctree-l1"><a class="reference internal" href="output-files.html">Output files</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="setting-tags.html">Setting tags</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="animation.html">How to watch animation</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="command-options.html">Command options</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamic-structure-factor.html">Dynamic structure factor</a></li>
<li class="toctree-l1"><a class="reference internal" href="gruneisen.html">Mode Grüneisen parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="qha.html">Quasi harmonic approximation</a></li>
<li class="toctree-l1"><a class="reference internal" href="random-displacements.html">Random displacements</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="interfaces.html">Interfaces to calculators</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="vasp.html">VASP &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="wien2k.html">Wien2k &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="qe.html">Quantum ESPRESSO (QE) &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="abinit.html">Abinit &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="siesta.html">Siesta &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="elk.html">Elk &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="crystal.html">CRYSTAL &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="dftb%2B.html">DFTB+ &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="turbomole.html">TURBOMOLE &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="cp2k.html">CP2K &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="aims.html">FHI-aims &amp; phonopy calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="castep.html">CASTEP &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Fleur.html">Fleur &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="abacus.html">ABACUS &amp; phonopy calculation</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">LAMMPS &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="vasp-dfpt.html">VASP-DFPT &amp; phonopy calculation</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="auxiliary-tools.html">Auxiliary tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="external-tools.html">External tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="phonopy-module.html">Phonopy API for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="phonopy-yaml.html">phonopy-yaml format</a></li>
<li class="toctree-l1"><a class="reference internal" href="phonopy-load.html">phonopy-load command</a></li>
<li class="toctree-l1"><a class="reference internal" href="formulation.html">Formulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">How to cite phonopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/lammps.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>LAMMPS & phonopy calculation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-handle-lammps-input-and-output-files-in-phonopy">How to handle LAMMPS input and output files in phonopy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#supported-lammps-structure-input-format">Supported LAMMPS structure input format</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supported-read-data-keywords-in-the-header">Supported <code class="docutils literal notranslate"><span class="pre">read_data</span></code> keywords in the header</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supported-read-data-keywords-in-the-body">Supported <code class="docutils literal notranslate"><span class="pre">read_data</span></code> keywords in the body</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lammps-input-script-for-force-calculation">LAMMPS input script for force calculation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-run-ti-lammps-example">How to run Ti-lammps example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#supercell-generation-from-unit-cell-defined-in-yaml">Supercell generation from unit cell defined in yaml</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#appendix-structure-optimization-using-lammps">Appendix: Structure optimization using LAMMPS</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lammps-phonopy-calculation">
<span id="lammps-interface"></span><h1>LAMMPS &amp; phonopy calculation<a class="headerlink" href="#lammps-phonopy-calculation" title="Link to this heading">#</a></h1>
<section id="how-to-handle-lammps-input-and-output-files-in-phonopy">
<h2>How to handle LAMMPS input and output files in phonopy<a class="headerlink" href="#how-to-handle-lammps-input-and-output-files-in-phonopy" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Phonopy assumes the LAMMPS calculation is performed in <code class="docutils literal notranslate"><span class="pre">units</span> <span class="pre">metal</span></code> and <code class="docutils literal notranslate"><span class="pre">atom_style</span> <span class="pre">atomic</span></code>.</p></li>
<li><p>Format of version 15Sep2022 or later of LAMMPS is assumed.</p></li>
<li><p>Force calculation has to performed by a specific setting as presented at
<a class="reference internal" href="#lammps-input-script-format"><span class="std std-ref">LAMMPS input script for force calculation</span></a>.</p></li>
</ul>
</section>
<section id="supported-lammps-structure-input-format">
<span id="lammps-structure-input-format"></span><h2>Supported LAMMPS structure input format<a class="headerlink" href="#supported-lammps-structure-input-format" title="Link to this heading">#</a></h2>
<p>Two important limitations are:</p>
<ul class="simple">
<li><p>Crystal structure has to be described in the similar format for
<a class="reference external" href="https://docs.lammps.org/read_data.html">read_data</a>.</p></li>
<li><p>Basis vectors are rotated to match the LAMMPS structure file format of
<a class="reference external" href="https://docs.lammps.org/Howto_triclinic.html">triclinic simulation box</a>.</p></li>
</ul>
<section id="supported-read-data-keywords-in-the-header">
<h3>Supported <code class="docutils literal notranslate"><span class="pre">read_data</span></code> keywords in the header<a class="headerlink" href="#supported-read-data-keywords-in-the-header" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">atoms</span>
<span class="n">atom</span> <span class="n">types</span>
<span class="n">xlo</span> <span class="n">xhi</span>
<span class="n">ylo</span> <span class="n">yhi</span>
<span class="n">zlo</span> <span class="n">zhi</span>
<span class="n">xy</span> <span class="n">xz</span> <span class="n">yz</span>
</pre></div>
</div>
</section>
<section id="supported-read-data-keywords-in-the-body">
<h3>Supported <code class="docutils literal notranslate"><span class="pre">read_data</span></code> keywords in the body<a class="headerlink" href="#supported-read-data-keywords-in-the-body" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Atoms</span>
<span class="n">Atom</span> <span class="n">Type</span> <span class="n">Labels</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Atom</span> <span class="pre">Type</span> <span class="pre">Labels</span></code> is the keyword new in version 15Sep2022 of LAMMPS. See
<a class="reference external" href="https://docs.lammps.org/Howto_type_labels.html">Type labels</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">Masses</span></code> has not been supported yet.</p>
</section>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Link to this heading">#</a></h3>
<p>The crystal structure is converted to the LAMMPS structure format of <a class="reference external" href="https://docs.lammps.org/Howto_triclinic.html">triclinic
simulation box</a>.</p>
<p>LAMMPS triclinic simulation box requires basis vectors to be described in the
following way</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_x</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_x</span> <span class="n">b_y</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">c_x</span> <span class="n">c_y</span> <span class="n">c_z</span><span class="p">)</span>
</pre></div>
</div>
<p>An example of HCP crystal structure is given as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>

<span class="mi">2</span> <span class="n">atoms</span>
<span class="mi">1</span> <span class="n">atom</span> <span class="n">types</span>

<span class="mf">0.0</span> <span class="mf">2.923479689273095</span> <span class="n">xlo</span> <span class="n">xhi</span>   <span class="c1"># xx</span>
<span class="mf">0.0</span> <span class="mf">2.531807678358337</span> <span class="n">ylo</span> <span class="n">yhi</span>   <span class="c1"># yy</span>
<span class="mf">0.0</span> <span class="mf">4.624022835916574</span> <span class="n">zlo</span> <span class="n">zhi</span>   <span class="c1"># zz</span>

<span class="o">-</span><span class="mf">1.461739844636547</span> <span class="mf">0.000000000000000</span> <span class="mf">0.000000000000000</span> <span class="n">xy</span> <span class="n">xz</span> <span class="n">yz</span>

<span class="n">Atom</span> <span class="n">Type</span> <span class="n">Labels</span>

<span class="mi">1</span> <span class="n">Ti</span>

<span class="n">Atoms</span>

<span class="mi">1</span> <span class="n">Ti</span> <span class="mf">0.000000000000001</span> <span class="mf">1.687871785572226</span> <span class="mf">3.468017126937431</span>
<span class="mi">2</span> <span class="n">Ti</span> <span class="mf">1.461739844636549</span> <span class="mf">0.843935892786111</span> <span class="mf">1.156005708979144</span>
</pre></div>
</div>
</section>
</section>
<section id="lammps-input-script-for-force-calculation">
<span id="lammps-input-script-format"></span><h2>LAMMPS input script for force calculation<a class="headerlink" href="#lammps-input-script-for-force-calculation" title="Link to this heading">#</a></h2>
<p>Phonopy can reads forces only from LAMMPS output file written in a specific text
format. An example of LAMMPS input script for phonopy force calculation is shown
below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">units</span> <span class="n">metal</span>

<span class="n">read_data</span> <span class="n">supercell</span><span class="o">-</span><span class="mi">001</span>

<span class="n">pair_style</span>  <span class="n">polymlp</span>
<span class="n">pair_coeff</span> <span class="o">*</span> <span class="o">*</span> <span class="n">mlp</span><span class="o">.</span><span class="n">lammps</span> <span class="n">dummy</span>

<span class="n">dump</span> <span class="n">phonopy</span> <span class="nb">all</span> <span class="n">custom</span> <span class="mi">1</span> <span class="n">force</span><span class="o">.*</span> <span class="nb">id</span> <span class="nb">type</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="n">fx</span> <span class="n">fy</span> <span class="n">fz</span>
<span class="n">dump_modify</span> <span class="n">phonopy</span> <span class="nb">format</span> <span class="n">line</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2"> </span><span class="si">%15.8f</span><span class="s2"> </span><span class="si">%15.8f</span><span class="s2"> </span><span class="si">%15.8f</span><span class="s2"> </span><span class="si">%15.8f</span><span class="s2"> </span><span class="si">%15.8f</span><span class="s2"> </span><span class="si">%15.8f</span><span class="s2">&quot;</span>
<span class="n">run</span> <span class="mi">0</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">supercell-001</span></code> is that generated by phonopy. The <code class="docutils literal notranslate"><span class="pre">pair_style</span></code> of
<code class="docutils literal notranslate"><span class="pre">polymlp</span></code> is a LAMMPS module of the polynomial machine learning potentials
provided at <a class="reference external" href="https://sekocha.github.io/lammps/index-e.html">https://sekocha.github.io/lammps/index-e.html</a>. For the HCP Ti
calculation found in the <a class="reference external" href="https://github.com/phonopy/phonopy/tree/develop/example">example
directory</a>, <code class="docutils literal notranslate"><span class="pre">mlp.lammp</span></code>
of gtinv-294 was obtained from <a class="reference external" href="http://cms.mtl.kyoto-u.ac.jp/seko/mlp-repository/index.html">Polynomial Machine Learning Potential Repository
at Kyoto
University</a>.</p>
</section>
<section id="how-to-run-ti-lammps-example">
<h2>How to run Ti-lammps example<a class="headerlink" href="#how-to-run-ti-lammps-example" title="Link to this heading">#</a></h2>
<ol class="arabic">
<li><p>Read a lammps input structure file and create supercells with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phonopy</span> <span class="o">--</span><span class="n">lammps</span> <span class="o">-</span><span class="n">c</span> <span class="n">lammps_structure_Ti</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">dim</span> <span class="mi">4</span> <span class="mi">4</span> <span class="mi">3</span>
        <span class="n">_</span>
  <span class="n">_</span> <span class="n">__</span> <span class="o">|</span> <span class="o">|</span><span class="n">__</span>   <span class="n">___</span>  <span class="n">_</span> <span class="n">__</span>   <span class="n">___</span>   <span class="n">_</span> <span class="n">__</span>  <span class="n">_</span>   <span class="n">_</span>
 <span class="o">|</span> <span class="s1">&#39;_ \| &#39;</span><span class="n">_</span> \ <span class="o">/</span> <span class="n">_</span> \<span class="o">|</span> <span class="s1">&#39;_ \ / _ \ | &#39;</span><span class="n">_</span> \<span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>
 <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">||</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
 <span class="o">|</span> <span class="o">.</span><span class="n">__</span><span class="o">/|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="o">/|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">.</span><span class="n">__</span><span class="o">/</span> \<span class="n">__</span><span class="p">,</span> <span class="o">|</span>
 <span class="o">|</span><span class="n">_</span><span class="o">|</span>                            <span class="o">|</span><span class="n">_</span><span class="o">|</span>    <span class="o">|</span><span class="n">___</span><span class="o">/</span>
                                      <span class="mf">2.18.0</span>

<span class="n">Compiled</span> <span class="k">with</span> <span class="n">OpenMP</span> <span class="n">support</span> <span class="p">(</span><span class="nb">max</span> <span class="mi">10</span> <span class="n">threads</span><span class="p">)</span><span class="o">.</span>
<span class="n">Python</span> <span class="n">version</span> <span class="mf">3.10.8</span>
<span class="n">Spglib</span> <span class="n">version</span> <span class="mf">2.0.2</span>

<span class="n">Calculator</span> <span class="n">interface</span><span class="p">:</span> <span class="n">lammps</span>
<span class="n">Crystal</span> <span class="n">structure</span> <span class="n">was</span> <span class="n">read</span> <span class="kn">from</span> <span class="s2">&quot;lammps_structure_Ti&quot;</span><span class="o">.</span>
<span class="n">Unit</span> <span class="n">of</span> <span class="n">length</span><span class="p">:</span> <span class="n">angstrom</span>
<span class="n">Displacements</span> <span class="n">creation</span> <span class="n">mode</span>
<span class="n">Settings</span><span class="p">:</span>
  <span class="n">Supercell</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">4</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">Spacegroup</span><span class="p">:</span> <span class="n">P6_3</span><span class="o">/</span><span class="n">mmc</span> <span class="p">(</span><span class="mi">194</span><span class="p">)</span>
<span class="n">Use</span> <span class="o">-</span><span class="n">v</span> <span class="n">option</span> <span class="n">to</span> <span class="n">watch</span> <span class="n">primitive</span> <span class="n">cell</span><span class="p">,</span> <span class="n">unit</span> <span class="n">cell</span><span class="p">,</span> <span class="ow">and</span> <span class="n">supercell</span> <span class="n">structures</span><span class="o">.</span>

<span class="s2">&quot;phonopy_disp.yaml&quot;</span> <span class="ow">and</span> <span class="n">supercells</span> <span class="n">have</span> <span class="n">been</span> <span class="n">created</span><span class="o">.</span>

<span class="n">Summary</span> <span class="n">of</span> <span class="n">calculation</span> <span class="n">was</span> <span class="n">written</span> <span class="ow">in</span> <span class="s2">&quot;phonopy_disp.yaml&quot;</span><span class="o">.</span>
                 <span class="n">_</span>
   <span class="n">___</span> <span class="n">_</span> <span class="n">__</span>   <span class="n">__</span><span class="o">|</span> <span class="o">|</span>
  <span class="o">/</span> <span class="n">_</span> \ <span class="s1">&#39;_ \ / _` |</span>
 <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
  \<span class="n">___</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">__</span><span class="p">,</span><span class="n">_</span><span class="o">|</span>
</pre></div>
</div>
</li>
<li><p>Run LAMMPS</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span>lmp_serial<span class="w"> </span>-in<span class="w"> </span><span class="k">in</span>.polymlp
</pre></div>
</div>
<p>Suppose that the LAMMPS output file name is renamed to <code class="docutils literal notranslate"><span class="pre">lammps_forces_Ti.0</span></code>
after the LAMMPS calculation.</p>
</li>
<li><p>Make <code class="docutils literal notranslate"><span class="pre">FORCE_SETS</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phonopy</span> <span class="o">-</span><span class="n">f</span> <span class="n">lammps_forces_Ti</span><span class="mf">.0</span>
        <span class="n">_</span>
  <span class="n">_</span> <span class="n">__</span> <span class="o">|</span> <span class="o">|</span><span class="n">__</span>   <span class="n">___</span>  <span class="n">_</span> <span class="n">__</span>   <span class="n">___</span>   <span class="n">_</span> <span class="n">__</span>  <span class="n">_</span>   <span class="n">_</span>
 <span class="o">|</span> <span class="s1">&#39;_ \| &#39;</span><span class="n">_</span> \ <span class="o">/</span> <span class="n">_</span> \<span class="o">|</span> <span class="s1">&#39;_ \ / _ \ | &#39;</span><span class="n">_</span> \<span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>
 <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">||</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
 <span class="o">|</span> <span class="o">.</span><span class="n">__</span><span class="o">/|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="o">/|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">.</span><span class="n">__</span><span class="o">/</span> \<span class="n">__</span><span class="p">,</span> <span class="o">|</span>
 <span class="o">|</span><span class="n">_</span><span class="o">|</span>                            <span class="o">|</span><span class="n">_</span><span class="o">|</span>    <span class="o">|</span><span class="n">___</span><span class="o">/</span>
                                      <span class="mf">2.18.0</span>

<span class="n">Compiled</span> <span class="k">with</span> <span class="n">OpenMP</span> <span class="n">support</span> <span class="p">(</span><span class="nb">max</span> <span class="mi">10</span> <span class="n">threads</span><span class="p">)</span><span class="o">.</span>
<span class="n">Python</span> <span class="n">version</span> <span class="mf">3.10.8</span>
<span class="n">Spglib</span> <span class="n">version</span> <span class="mf">2.0.2</span>

<span class="n">Calculator</span> <span class="n">interface</span><span class="p">:</span> <span class="n">lammps</span>
<span class="n">Displacements</span> <span class="n">were</span> <span class="n">read</span> <span class="kn">from</span> <span class="s2">&quot;phonopy_disp.yaml&quot;</span><span class="o">.</span>
<span class="mf">1.</span> <span class="n">Drift</span> <span class="n">force</span> <span class="n">of</span> <span class="s2">&quot;lammps_forces_Ti.0&quot;</span> <span class="n">to</span> <span class="n">be</span> <span class="n">subtracted</span>
 <span class="o">-</span><span class="mf">0.00000000</span>  <span class="o">-</span><span class="mf">0.00000000</span>   <span class="mf">0.00000000</span>
<span class="n">Forces</span> <span class="n">parsed</span> <span class="kn">from</span> <span class="nn">LAMMPS</span> <span class="n">output</span> <span class="n">were</span> <span class="n">rotated</span> <span class="n">by</span> <span class="n">F</span><span class="o">=</span><span class="n">R</span><span class="o">.</span><span class="n">F</span><span class="p">(</span><span class="n">lammps</span><span class="p">)</span> <span class="k">with</span> <span class="n">R</span><span class="p">:</span>
  <span class="mf">1.00000</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span>
  <span class="mf">0.00000</span> <span class="mf">0.00000</span> <span class="mf">0.00000</span>
  <span class="mf">0.00000</span> <span class="mf">1.00000</span> <span class="mf">1.00000</span>
<span class="s2">&quot;FORCE_SETS&quot;</span> <span class="n">has</span> <span class="n">been</span> <span class="n">created</span><span class="o">.</span>
                 <span class="n">_</span>
   <span class="n">___</span> <span class="n">_</span> <span class="n">__</span>   <span class="n">__</span><span class="o">|</span> <span class="o">|</span>
  <span class="o">/</span> <span class="n">_</span> \ <span class="s1">&#39;_ \ / _` |</span>
 <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
  \<span class="n">___</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">__</span><span class="p">,</span><span class="n">_</span><span class="o">|</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="supercell-generation-from-unit-cell-defined-in-yaml">
<h2>Supercell generation from unit cell defined in yaml<a class="headerlink" href="#supercell-generation-from-unit-cell-defined-in-yaml" title="Link to this heading">#</a></h2>
<p>LAMMPS input structure that phonopy can read must follow the convention of the
basis vector orientation in Cartesian coordinates. If it is unconformable for
the phonon calculation setting, we can generate supercells with displacements
from a structure format in yaml. A silicon primitive cell example is given as
follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">lattice</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0.000000000000000</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2.733099421887393</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2.733099421887393</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="c1"># a</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">2.733099421887393</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.000000000000000</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2.733099421887393</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="c1"># b</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">2.733099421887393</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2.733099421887393</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.000000000000000</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="c1"># c</span>
<span class="nt">points</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">symbol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Si</span><span class="w"> </span><span class="c1"># 1</span>
<span class="w">  </span><span class="nt">coordinates</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0.875000000000000</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.875000000000000</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.875000000000000</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">symbol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Si</span><span class="w"> </span><span class="c1"># 2</span>
<span class="w">  </span><span class="nt">coordinates</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0.125000000000000</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.125000000000000</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.125000000000000</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>With this saved in <code class="docutils literal notranslate"><span class="pre">phonopy_unitcell.yaml</span></code> file, we can generate 2x2x2 supercell
of this primitive cell orientation by using a python script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">phonopy</span>
<span class="kn">from</span> <span class="nn">phonopy.interface.phonopy_yaml</span> <span class="kn">import</span> <span class="n">read_cell_yaml</span>
<span class="kn">from</span> <span class="nn">phonopy.interface.calculator</span> <span class="kn">import</span> <span class="n">write_supercells_with_displacements</span>

<span class="n">cell</span> <span class="o">=</span> <span class="n">read_cell_yaml</span><span class="p">(</span><span class="s2">&quot;phonopy_unitcell.yaml&quot;</span><span class="p">)</span>
<span class="n">ph</span> <span class="o">=</span> <span class="n">phonopy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">unitcell</span><span class="o">=</span><span class="n">cell</span><span class="p">,</span> <span class="n">primitive_matrix</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">supercell_matrix</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">calculator</span><span class="o">=</span><span class="s1">&#39;lammps&#39;</span><span class="p">)</span>
<span class="n">ph</span><span class="o">.</span><span class="n">generate_displacements</span><span class="p">()</span>
<span class="n">ph</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;phonopy_disp.yaml&quot;</span><span class="p">)</span>
<span class="n">write_supercells_with_displacements</span><span class="p">(</span><span class="s2">&quot;lammps&quot;</span><span class="p">,</span> <span class="n">ph</span><span class="o">.</span><span class="n">supercell</span><span class="p">,</span> <span class="n">ph</span><span class="o">.</span><span class="n">supercells_with_displacements</span><span class="p">)</span>
</pre></div>
</div>
<p>The primitive and supercell structures are stored in <code class="docutils literal notranslate"><span class="pre">phonopy_disp.yaml</span></code> in the
original orientation. But <code class="docutils literal notranslate"><span class="pre">supercell-001</span></code> follows the convention of the LAMMPS
input structure file format.</p>
</section>
<section id="appendix-structure-optimization-using-lammps">
<h2>Appendix: Structure optimization using LAMMPS<a class="headerlink" href="#appendix-structure-optimization-using-lammps" title="Link to this heading">#</a></h2>
<p>It is necessary to relax crystal structure before starting phonon calculation.
At least vanishing residual forces on atoms are expected. Using LAMMPS, crystal
structure can be optimized under different constraints. The following is the
simplest optimization where only internal atomic positions are relaxed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>units metal

read_data unitcell

pair_style  polymlp
pair_coeff * * mlp.lammps dummy

variable etol equal 0.0
variable ftol equal 1e-8
variable maxiter equal 1000
variable maxeval equal 100000

minimize ${etol} ${ftol} ${maxiter} ${maxeval}

write_data dump.unitcell
</pre></div>
</div>
<p>More instruction is found at
<a class="reference external" href="https://gist.github.com/lan496/e9dff8449cd7489f6722b276282e66a0">https://gist.github.com/lan496/e9dff8449cd7489f6722b276282e66a0</a>.</p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="abacus.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">ABACUS &amp; phonopy calculation</p>
      </div>
    </a>
    <a class="right-next"
       href="vasp-dfpt.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">VASP-DFPT &amp; phonopy calculation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-handle-lammps-input-and-output-files-in-phonopy">How to handle LAMMPS input and output files in phonopy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#supported-lammps-structure-input-format">Supported LAMMPS structure input format</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supported-read-data-keywords-in-the-header">Supported <code class="docutils literal notranslate"><span class="pre">read_data</span></code> keywords in the header</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supported-read-data-keywords-in-the-body">Supported <code class="docutils literal notranslate"><span class="pre">read_data</span></code> keywords in the body</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lammps-input-script-for-force-calculation">LAMMPS input script for force calculation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-run-ti-lammps-example">How to run Ti-lammps example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#supercell-generation-from-unit-cell-defined-in-yaml">Supercell generation from unit cell defined in yaml</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#appendix-structure-optimization-using-lammps">Appendix: Structure optimization using LAMMPS</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2009, Atsushi Togo.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>