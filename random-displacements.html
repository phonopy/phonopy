
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Random displacements &#8212; Phonopy v.2.26.6</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=6baedd6d"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'random-displacements';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Interfaces to calculators" href="interfaces.html" />
    <link rel="prev" title="Quasi harmonic approximation" href="qha.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">Phonopy v.2.26.6</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="symmetry.html">Crystal symmetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Work flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="input-files.html">Input files</a></li>
<li class="toctree-l1"><a class="reference internal" href="output-files.html">Output files</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="setting-tags.html">Setting tags</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="animation.html">How to watch animation</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="command-options.html">Command options</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamic-structure-factor.html">Dynamic structure factor</a></li>
<li class="toctree-l1"><a class="reference internal" href="gruneisen.html">Mode Grüneisen parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="qha.html">Quasi harmonic approximation</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Random displacements</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="interfaces.html">Interfaces to calculators</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="vasp.html">VASP &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="wien2k.html">Wien2k &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="qe.html">Quantum ESPRESSO (QE) &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="abinit.html">Abinit &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="siesta.html">Siesta &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="elk.html">Elk &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="crystal.html">CRYSTAL &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="dftb%2B.html">DFTB+ &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="turbomole.html">TURBOMOLE &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="cp2k.html">CP2K &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="aims.html">FHI-aims &amp; phonopy calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="castep.html">CASTEP &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Fleur.html">Fleur &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="abacus.html">ABACUS &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="lammps.html">LAMMPS &amp; phonopy calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="vasp-dfpt.html">VASP-DFPT &amp; phonopy calculation</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="auxiliary-tools.html">Auxiliary tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="external-tools.html">External tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="phonopy-module.html">Phonopy API for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="phonopy-yaml.html">phonopy-yaml format</a></li>
<li class="toctree-l1"><a class="reference internal" href="phonopy-load.html">phonopy-load command</a></li>
<li class="toctree-l1"><a class="reference internal" href="formulation.html">Formulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">How to cite phonopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/random-displacements.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Random displacements</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#related-setting-tags">Related setting tags</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#random-directions-with-constant-displacement-distance">Random directions with constant displacement distance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#random-sampling-of-harmonic-oscillator-probability-densities-of-phonon-modes">Random sampling of harmonic oscillator probability densities of phonon modes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-of-displacement-distance-distribution">Visualization of displacement distance distribution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#another-example">Another example</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="random-displacements">
<span id="id1"></span><h1>Random displacements<a class="headerlink" href="#random-displacements" title="Link to this heading">#</a></h1>
<p>Phonopy supports generating two types of random displacements.</p>
<ul class="simple">
<li><p>Random directions with constant displacement distance</p></li>
<li><p>Random sampling of harmonic oscillator probability densities of phonon modes</p></li>
</ul>
<p>In both cases, phonopy generates dataset of displacements of supercells in
<code class="docutils literal notranslate"><span class="pre">phonopy_disp.yaml</span></code>, supercells with displacements, and a perfect supercell. The
number of the supercells with displacements are specified by
<a class="reference internal" href="setting-tags.html#random-displacements-tag"><span class="std std-ref">RANDOM_DISPLACEMENTS</span></a> tag (or <code class="docutils literal notranslate"><span class="pre">--rd</span></code> option) in either case.</p>
<p>Forces on atoms in supercells with displacements are calculated by a force
calculator and force constants are computed by a force constants calculator. As
the force constants calculator, currently only <a class="reference internal" href="setting-tags.html#fc-calculator-alm-tag"><span class="std std-ref">SYMFC</span></a> is
supported.</p>
<section id="related-setting-tags">
<h2>Related setting tags<a class="headerlink" href="#related-setting-tags" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="setting-tags.html#random-displacements-tag"><span class="std std-ref">RANDOM_DISPLACEMENTS</span></a> (<code class="docutils literal notranslate"><span class="pre">--rd</span></code>)</p></li>
<li><p><a class="reference internal" href="setting-tags.html#random-displacement-temperature-tag"><span class="std std-ref">RANDOM_DISPLACEMENT_TEMPERATURE</span></a> (<code class="docutils literal notranslate"><span class="pre">--rd-temperature</span></code>)</p></li>
<li><p><a class="reference internal" href="setting-tags.html#random-seed-tag"><span class="std std-ref">RANDOM_SEED</span></a> (<code class="docutils literal notranslate"><span class="pre">--random-seed</span></code>)</p></li>
<li><p><a class="reference internal" href="setting-tags.html#fc-calculator-tag"><span class="std std-ref">FC_CALCULATOR</span></a> (<code class="docutils literal notranslate"><span class="pre">--fc-calc</span></code>)</p></li>
<li><p><a class="reference internal" href="setting-tags.html#fc-calculator-options-tag"><span class="std std-ref">FC_CALCULATOR_OPTIONS</span></a> (<code class="docutils literal notranslate"><span class="pre">--fc-calc-opt</span></code>)</p></li>
</ul>
</section>
<section id="random-directions-with-constant-displacement-distance">
<h2>Random directions with constant displacement distance<a class="headerlink" href="#random-directions-with-constant-displacement-distance" title="Link to this heading">#</a></h2>
<p>See also <a class="reference internal" href="setting-tags.html#random-displacements-tag"><span class="std std-ref">RANDOM_DISPLACEMENTS</span></a>.</p>
<section id="example">
<span id="random-displacements-random-direction-example"></span><h3>Example<a class="headerlink" href="#example" title="Link to this heading">#</a></h3>
<p>An example to generate the random direction diplacements with distance of 0.03
Angstrom in <code class="docutils literal notranslate"><span class="pre">example/NaCl-rd</span></code> directory is as shown below,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">%</span> <span class="n">phonopy</span> <span class="o">--</span><span class="n">rd</span> <span class="mi">10</span> <span class="o">--</span><span class="n">dim</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="o">--</span><span class="n">pa</span> <span class="n">auto</span> <span class="o">--</span><span class="n">amplitude</span> <span class="mf">0.03</span> <span class="o">-</span><span class="n">c</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">unitcell</span>
         <span class="n">_</span>
  <span class="n">_</span> <span class="n">__</span> <span class="o">|</span> <span class="o">|</span><span class="n">__</span>   <span class="n">___</span>  <span class="n">_</span> <span class="n">__</span>   <span class="n">___</span>   <span class="n">_</span> <span class="n">__</span>  <span class="n">_</span>   <span class="n">_</span>
 <span class="o">|</span> <span class="s1">&#39;_ \| &#39;</span><span class="n">_</span> \ <span class="o">/</span> <span class="n">_</span> \<span class="o">|</span> <span class="s1">&#39;_ \ / _ \ | &#39;</span><span class="n">_</span> \<span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>
 <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">||</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
 <span class="o">|</span> <span class="o">.</span><span class="n">__</span><span class="o">/|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="o">/|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">.</span><span class="n">__</span><span class="o">/</span> \<span class="n">__</span><span class="p">,</span> <span class="o">|</span>
 <span class="o">|</span><span class="n">_</span><span class="o">|</span>                            <span class="o">|</span><span class="n">_</span><span class="o">|</span>    <span class="o">|</span><span class="n">___</span><span class="o">/</span>
                                      <span class="mf">2.20.0</span>

<span class="n">Compiled</span> <span class="k">with</span> <span class="n">OpenMP</span> <span class="n">support</span> <span class="p">(</span><span class="nb">max</span> <span class="mi">10</span> <span class="n">threads</span><span class="p">)</span><span class="o">.</span>
<span class="n">Python</span> <span class="n">version</span> <span class="mf">3.11.4</span>
<span class="n">Spglib</span> <span class="n">version</span> <span class="mf">2.1.0</span>

<span class="n">Crystal</span> <span class="n">structure</span> <span class="n">was</span> <span class="n">read</span> <span class="kn">from</span> <span class="s2">&quot;POSCAR-unitcell&quot;</span><span class="o">.</span>
<span class="n">Unit</span> <span class="n">of</span> <span class="n">length</span><span class="p">:</span> <span class="n">angstrom</span>
<span class="n">Displacements</span> <span class="n">creation</span> <span class="n">mode</span>
  <span class="n">Number</span> <span class="n">of</span> <span class="n">supercells</span> <span class="k">with</span> <span class="n">random</span> <span class="n">displacements</span><span class="p">:</span> <span class="mi">10</span>
  <span class="n">Displacement</span> <span class="n">distance</span><span class="p">:</span> <span class="mf">0.03</span>
<span class="n">Settings</span><span class="p">:</span>
  <span class="n">Supercell</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">Spacegroup</span><span class="p">:</span> <span class="n">Fm</span><span class="o">-</span><span class="mi">3</span><span class="n">m</span> <span class="p">(</span><span class="mi">225</span><span class="p">)</span>
<span class="n">Use</span> <span class="o">-</span><span class="n">v</span> <span class="n">option</span> <span class="n">to</span> <span class="n">watch</span> <span class="n">primitive</span> <span class="n">cell</span><span class="p">,</span> <span class="n">unit</span> <span class="n">cell</span><span class="p">,</span> <span class="ow">and</span> <span class="n">supercell</span> <span class="n">structures</span><span class="o">.</span>

<span class="s2">&quot;phonopy_disp.yaml&quot;</span> <span class="ow">and</span> <span class="n">supercells</span> <span class="n">have</span> <span class="n">been</span> <span class="n">created</span><span class="o">.</span>

<span class="n">Summary</span> <span class="n">of</span> <span class="n">calculation</span> <span class="n">was</span> <span class="n">written</span> <span class="ow">in</span> <span class="s2">&quot;phonopy_disp.yaml&quot;</span><span class="o">.</span>
                 <span class="n">_</span>
   <span class="n">___</span> <span class="n">_</span> <span class="n">__</span>   <span class="n">__</span><span class="o">|</span> <span class="o">|</span>
  <span class="o">/</span> <span class="n">_</span> \ <span class="s1">&#39;_ \ / _` |</span>
 <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
  \<span class="n">___</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">__</span><span class="p">,</span><span class="n">_</span><span class="o">|</span>
</pre></div>
</div>
<p>In the generated <code class="docutils literal notranslate"><span class="pre">phonopy_disp.yaml</span></code>, dataset of displacements is stored as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cat</span> <span class="n">phonopy_disp</span><span class="o">.</span><span class="n">yaml</span>
<span class="o">...</span>
<span class="n">displacements</span><span class="p">:</span>
<span class="o">-</span> <span class="c1">#    1</span>
  <span class="o">-</span> <span class="n">displacement</span><span class="p">:</span> <span class="c1"># 1</span>
      <span class="p">[</span>  <span class="o">-</span><span class="mf">0.0201336051051884</span><span class="p">,</span>  <span class="mf">0.0137526506253330</span><span class="p">,</span>  <span class="mf">0.0174786311319239</span> <span class="p">]</span>
  <span class="o">-</span> <span class="n">displacement</span><span class="p">:</span> <span class="c1"># 2</span>
      <span class="p">[</span>  <span class="o">-</span><span class="mf">0.0176810186962932</span><span class="p">,</span>  <span class="mf">0.0037245664471804</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0239480517504424</span> <span class="p">]</span>
  <span class="o">-</span> <span class="n">displacement</span><span class="p">:</span> <span class="c1"># 3</span>
      <span class="p">[</span>  <span class="o">-</span><span class="mf">0.0028626950563326</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0032145292137935</span><span class="p">,</span>  <span class="mf">0.0296895904139501</span> <span class="p">]</span>
  <span class="o">-</span> <span class="n">displacement</span><span class="p">:</span> <span class="c1"># 4</span>
      <span class="p">[</span>   <span class="mf">0.0251664434224757</span><span class="p">,</span>  <span class="mf">0.0149681266628547</span><span class="p">,</span>  <span class="mf">0.0065272742908559</span> <span class="p">]</span>
  <span class="o">-</span> <span class="n">displacement</span><span class="p">:</span> <span class="c1"># 5</span>
      <span class="p">[</span>  <span class="o">-</span><span class="mf">0.0136393731379345</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0226372187886819</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0141959087739228</span> <span class="p">]</span>
  <span class="o">-</span> <span class="n">displacement</span><span class="p">:</span> <span class="c1"># 6</span>
      <span class="p">[</span>   <span class="mf">0.0299122348895043</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0003839832933863</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0022606991718315</span> <span class="p">]</span>
  <span class="o">-</span> <span class="n">displacement</span><span class="p">:</span> <span class="c1"># 7</span>
      <span class="p">[</span>  <span class="o">-</span><span class="mf">0.0265153637733336</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0030921513486749</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0136884653633881</span> <span class="p">]</span>
  <span class="o">-</span> <span class="n">displacement</span><span class="p">:</span> <span class="c1"># 8</span>
      <span class="p">[</span>   <span class="mf">0.0284712562630672</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0049105574746481</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0080792321473599</span> <span class="p">]</span>
<span class="o">...</span>
</pre></div>
</div>
<p>where the displacements are given in the Cartesian coordinates. The supercell
with displacements in the VASP interface is found as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cat</span> <span class="n">POSCAR</span><span class="o">-</span><span class="mi">001</span>
<span class="n">generated</span> <span class="n">by</span> <span class="n">phonopy</span>
<span class="mf">1.0</span>
<span class="mf">11.3806029523513423</span> <span class="mf">0.0000000000000000</span> <span class="mf">0.0000000000000000</span>
<span class="mf">0.0000000000000000</span> <span class="mf">11.3806029523513423</span> <span class="mf">0.0000000000000000</span>
<span class="mf">0.0000000000000000</span> <span class="mf">0.0000000000000000</span> <span class="mf">11.3806029523513423</span>
<span class="n">Na</span> <span class="n">Cl</span>
<span class="mi">32</span> <span class="mi">32</span>
<span class="n">Direct</span>
<span class="mf">0.9982308841465181</span> <span class="mf">0.0012084289982625</span> <span class="mf">0.0015358264588532</span>
<span class="mf">0.4984463899873917</span> <span class="mf">0.0003272732088778</span> <span class="mf">0.9978957132718971</span>
<span class="mf">0.9997484584016929</span> <span class="mf">0.4997175431541499</span> <span class="mf">0.0026087888786082</span>
<span class="mf">0.5022113453503161</span> <span class="mf">0.5013152314271505</span> <span class="mf">0.0005735438023965</span>
<span class="mf">0.9988015245593718</span> <span class="mf">0.9980108945999205</span> <span class="mf">0.4987526224371979</span>
<span class="mf">0.5026283523829750</span> <span class="mf">0.9999662598462494</span> <span class="mf">0.4998013550616521</span>
<span class="mf">0.9976701266282333</span> <span class="mf">0.4997282963511142</span> <span class="mf">0.4987972108841070</span>
<span class="mf">0.5025017353107100</span> <span class="mf">0.4995685151748806</span> <span class="mf">0.4992900875128334</span>
<span class="o">...</span>
</pre></div>
</div>
<p>It is easy to verify consistency between them, e.g.,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ph</span><span class="o">.</span><span class="n">displacements</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">ph</span><span class="o">.</span><span class="n">supercell</span><span class="o">.</span><span class="n">cell</span><span class="p">))</span> <span class="o">+</span> <span class="n">ph</span><span class="o">.</span><span class="n">supercell</span><span class="o">.</span><span class="n">scaled_positions</span>
</pre></div>
</div>
<p>Once forces on atoms in these supercells with displacements, <code class="docutils literal notranslate"><span class="pre">FORCE_SETS</span></code> can be generated by the usual manner. For the <code class="docutils literal notranslate"><span class="pre">NaCl-rd</span></code> example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phonopy</span> <span class="o">-</span><span class="n">f</span> <span class="n">force</span><span class="o">-</span><span class="n">calcs</span><span class="o">/</span><span class="n">disp</span><span class="o">-</span><span class="p">{</span><span class="mf">001..010</span><span class="p">}</span><span class="o">/</span><span class="n">vasprun</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">phonopy_disp.yaml</span></code> has to be located in the current directory where the
above command is executed. The <code class="docutils literal notranslate"><span class="pre">FORCE_SETS</span></code> file is written in the
<a class="reference internal" href="input-files.html#file-forces-type-2"><span class="std std-ref">Type 2</span></a> format. To compute force constants for the type-2
displacements-forces dataset, an external force constants calculator is
necessary, e.g., ALM (<a class="github reference external" href="https://github.com/ttadano/ALM">ttadano/ALM</a>). With installed ALM, force
constants can be calculated by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phonopy</span> <span class="o">--</span><span class="n">alm</span> <span class="o">--</span><span class="n">writefc</span>
</pre></div>
</div>
<p>With this command, the force constants are written in <code class="docutils literal notranslate"><span class="pre">FORCE_CONSTANTS</span></code>.</p>
</section>
</section>
<section id="random-sampling-of-harmonic-oscillator-probability-densities-of-phonon-modes">
<span id="random-displacements-at-temperatures"></span><h2>Random sampling of harmonic oscillator probability densities of phonon modes<a class="headerlink" href="#random-sampling-of-harmonic-oscillator-probability-densities-of-phonon-modes" title="Link to this heading">#</a></h2>
<p>Random displacements corresponding to a specific temperature are generated with
the combination of the <a class="reference internal" href="setting-tags.html#random-displacements-tag"><span class="std std-ref">RANDOM_DISPLACEMENTS</span></a> (<code class="docutils literal notranslate"><span class="pre">--rd</span></code>) and
<a class="reference internal" href="setting-tags.html#random-displacement-temperature-tag"><span class="std std-ref">RANDOM_DISPLACEMENT_TEMPERATURE</span></a> tags. This is based on the harmonic
phonon approximation. Since each phonon follows the probability density function
of the harmonic oscillator, the random displacements are generated by randomly
sampling the probability density functions of phonons at the commensurate
points. More details are found in the paper “Implementation
strategies in phonopy and phono3py” (see <a class="reference internal" href="citation.html#citation-of-phonopy"><span class="std std-ref">Citation of phonopy</span></a>).</p>
<section id="id2">
<h3>Example<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>To generate the random displacements in this approach, phonon information is
required. At the first step, phonons at the commensurate points are calculated.
Then, the random displacements are generated in the next step. If
<code class="docutils literal notranslate"><span class="pre">FORCE_CONSTANTS</span></code> file exists in the current directory, as an example, this is
performed by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phonopy</span> <span class="o">--</span><span class="n">readfc</span> <span class="o">--</span><span class="n">rd</span> <span class="mi">1000</span> <span class="o">--</span><span class="n">temperature</span> <span class="mi">300</span>
</pre></div>
</div>
<p>where 1000 supercells with displacements at 300K are generated.</p>
</section>
<section id="visualization-of-displacement-distance-distribution">
<h3>Visualization of displacement distance distribution<a class="headerlink" href="#visualization-of-displacement-distance-distribution" title="Link to this heading">#</a></h3>
<p>Distribution of displacement distances may be visualized and checked by a python
script like below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">phonopy.interface.phonopy_yaml</span> <span class="kn">import</span> <span class="n">PhonopyYaml</span>
<span class="n">phyml</span> <span class="o">=</span> <span class="n">PhonopyYaml</span><span class="p">()</span>
<span class="n">phyml</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;phonopy_disp.yaml&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">phyml</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;displacements&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/NaCl-disp-dist.png"><img alt="_images/NaCl-disp-dist.png" src="_images/NaCl-disp-dist.png" style="width: 320.0px; height: 240.0px;" />
</a>
</section>
<section id="another-example">
<h3>Another example<a class="headerlink" href="#another-example" title="Link to this heading">#</a></h3>
<p>In the below, a step-by-step example is presented.</p>
<ol class="arabic">
<li><p>Compute supercell force sets in the usual manner with small displacements.
Generate <code class="docutils literal notranslate"><span class="pre">FORCE_SETS</span></code> in the current directory.</p></li>
<li><p>Create new directory and copy <code class="docutils literal notranslate"><span class="pre">FORCE_SETS</span></code> and input crystal structure, or
<code class="docutils literal notranslate"><span class="pre">phonopy_disp.yaml</span></code> to the new directory, then change to the new directory.</p></li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">FORCE_SETS</span></code>, generate supercells with random displacements at finite
temperature using this tag. <code class="docutils literal notranslate"><span class="pre">phonopy_disp.yaml</span></code> is generated at this step.
Therefore, if <code class="docutils literal notranslate"><span class="pre">phonopy_disp.yaml</span></code> already exists in this directory, it is
overwritten. The required number of supercells depends on your system and
also the purpose. It can be 10, or can be 1000.</p></li>
<li><p>Using those supercells with random displacements, calculate supercell forces
with some force calculator with VASP, QE, etc.</p></li>
<li><p>Generate <code class="docutils literal notranslate"><span class="pre">FORCE_SETS</span></code> in this directory, which overwrites previous
<code class="docutils literal notranslate"><span class="pre">FORCE_SETS</span></code>.</p></li>
<li><p>Run the force constants calculation, e.g., with ALM. ALM does the fitting
force constants using the dataset of displacements and forces stored in
<code class="docutils literal notranslate"><span class="pre">FORCE_SETS</span></code>. Run also phonon calculation. This is done for example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phonopy</span> <span class="o">-</span><span class="n">v</span> <span class="o">--</span><span class="n">alm</span> <span class="o">--</span><span class="n">mesh</span> <span class="mi">10</span> <span class="mi">10</span> <span class="mi">10</span> <span class="o">-</span><span class="n">p</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>phonopy<span class="w"> </span>-v<span class="w"> </span>--alm<span class="w"> </span>--writefc
phonopy<span class="w"> </span>--readfc<span class="w"> </span>--mesh<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">10</span><span class="w"> </span>-p
</pre></div>
</div>
<p>Force constants calculated as above contain a part of temperature effect from
atomic displacements. To even better include the temperature effect, this
calculation has to be done self-consistently, i.e., it is required to repeat
the loop over the steps 2-5 until the phonon structure is converged. The
solution corresponds to a stochastic self-consistent harmonic approximation
(<a class="reference internal" href="reference.html#reference-sscha"><span class="std std-ref">SSCHA</span></a>) approach.</p>
</li>
</ol>
<p>It is also possible to perform the same calculation as above using the phonopy API.</p>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="qha.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Quasi harmonic approximation</p>
      </div>
    </a>
    <a class="right-next"
       href="interfaces.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Interfaces to calculators</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#related-setting-tags">Related setting tags</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#random-directions-with-constant-displacement-distance">Random directions with constant displacement distance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#random-sampling-of-harmonic-oscillator-probability-densities-of-phonon-modes">Random sampling of harmonic oscillator probability densities of phonon modes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-of-displacement-distance-distribution">Visualization of displacement distance distribution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#another-example">Another example</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Author name not set
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2009, Atsushi Togo.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>